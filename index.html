<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Idle Realm</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:radial-gradient(circle at top,#1b2a4a,#050914);
  color:#e5e7eb;
}
header{
  padding:10px;
  display:flex;
  justify-content:space-around;
  background:#050914;
  font-size:14px;
}
.container{padding:16px;max-width:420px;margin:auto}
h1{margin:8px 0 0;font-size:30px}
.subtitle{opacity:.7;margin-bottom:16px}

.card{
  background:rgba(255,255,255,.06);
  border-radius:16px;
  padding:16px;
  margin-bottom:18px;
}
button{
  width:100%;
  padding:14px;
  margin-top:10px;
  border:none;
  border-radius:14px;
  font-size:16px;
  background:#2563eb;
  color:white;
}
button:disabled{opacity:.4}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}
.tile{
  height:70px;
  border-radius:14px;
  background:rgba(255,255,255,.08);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:30px;
}
.log{font-size:14px;opacity:.85}
.cooldown{color:#facc15;font-weight:600}
</style>
</head>

<body>

<header>
  üë• <span id="pop"></span>
  ‚öíÔ∏è <span id="prod"></span>
  üõ°Ô∏è <span id="stab"></span>%
  ‚è≥ <span id="time"></span>
</header>

<div class="container">
<h1>Idle Realm</h1>
<div class="subtitle">A living world shaped by time and choices</div>

<div class="card">
<h2>Build</h2>
<button id="bSettlement">üè† Settlement</button>
<button id="bWorkshop">üõ† Workshop</button>
<button id="bCouncil">üèõ Council</button>
<div id="cooldown" class="cooldown"></div>
</div>

<div class="card">
<h2>City</h2>
<div id="city" class="grid"></div>
</div>

<div class="card">
<h2>Era</h2>
<div id="eraText"></div>
</div>

<div class="card">
<h2>Events</h2>
<div id="events" class="log"></div>
</div>

<div class="card">
<h2>Realm Chronicle</h2>
<div id="chronicle" class="log"></div>
</div>
</div>

<script>
/* ===== STATE ===== */
let era = 1; // 1=Clans, 2=Bronze
let population = 10;
let production = 30;
let stability = 100;
let time = 0;

let settlements=0, workshops=0, council=false;
let citySize = 9;
let city = Array(citySize).fill(null);

let cooldown = 0;
let COOLDOWN_MAX = 8;

/* ===== TEXT ===== */
const chronicles = {
  1:[
    "Small clans gather around fire and stone.",
    "Growth is fast, but fragile.",
    "The first settlements define survival."
  ],
  2:[
    "Bronze reshapes tools and power.",
    "Progress slows, choices deepen.",
    "Metal binds the fate of nations."
  ]
};

/* ===== HELPERS ===== */
const $=id=>document.getElementById(id);
const log=t=>$("events").innerHTML="‚Ä¢ "+t+"<br>"+$("events").innerHTML;

function renderCity(){
  $("city").innerHTML="";
  city.forEach(t=>{
    const d=document.createElement("div");
    d.className="tile";
    d.textContent=t||"";
    $("city").appendChild(d);
  });
}
function emptySlot(){return city.findIndex(t=>t===null);}

/* ===== UI ===== */
function updateUI(){
  $("pop").textContent=population.toFixed(1);
  $("prod").textContent=production.toFixed(1);
  $("stab").textContent=Math.max(0,Math.min(100,stability)).toFixed(0);
  $("time").textContent=time;

  $("bSettlement").disabled=!canBuild("settlement");
  $("bWorkshop").disabled=!canBuild("workshop");
  $("bCouncil").disabled=!canBuild("council");

  $("cooldown").textContent=
    cooldown>0?`Cooldown: ${cooldown}s`:"";

  $("eraText").innerHTML =
    era===1
    ? "<b>Age of Clans</b><br>Fast growth. Learning phase."
    : "<b>Age of Bronze</b><br>Slower progress. Strategic depth.";
}

/* ===== ECONOMY (ERA BASED) ===== */
function productionPerSecond(){
  if(era===1){
    return 0.2 + workshops*0.6;
  }
  // ERA 2 slower
  return 0.1 + Math.pow(workshops,0.8)*0.5;
}

/* ===== BUILD RULES ===== */
function canBuild(type){
  if(cooldown>0) return false;
  if(emptySlot()<0) return false;

  if(type==="settlement") return production>=15;
  if(type==="workshop") return production>=20;
  if(type==="council") return production>=30 && !council;
  return false;
}

function build(type){
  if(!canBuild(type)) return;
  const slot=emptySlot();
  cooldown=COOLDOWN_MAX;

  if(type==="settlement"){
    production-=15;
    population+= era===1 ? 4 : 2;
    stability-=6;
    settlements++;
    city[slot]="üè†";
    log("Settlement expands population");
  }

  if(type==="workshop"){
    production-=20;
    workshops++;
    stability-=4;
    city[slot]="üõ†";
    log("Workshop improves production");
  }

  if(type==="council"){
    production-=30;
    stability+=20;
    council=true;
    city[slot]="üèõ";
    log("Council brings order");
  }

  checkEraTransition();
  updateUI();
  renderCity();
}

/* ===== ERA TRANSITION ===== */
function checkEraTransition(){
  if(era===1 && city.every(t=>t!==null) && stability>=60){
    era=2;
    citySize=12;
    city.push(null,null,null);
    COOLDOWN_MAX=12;
    log("‚öîÔ∏è The Age of Bronze begins!");
    updateChronicle();
  }
}

/* ===== CHRONICLE ===== */
let chronicleIndex=0;
function updateChronicle(){
  const arr=chronicles[era];
  $("chronicle").textContent=arr[chronicleIndex];
  chronicleIndex=(chronicleIndex+1)%arr.length;
}

/* ===== BUTTONS ===== */
bSettlement.onclick=()=>build("settlement");
bWorkshop.onclick=()=>build("workshop");
bCouncil.onclick=()=>build("council");

/* ===== TICK ===== */
setInterval(()=>{
  time++;
  production+=productionPerSecond();
  if(cooldown>0) cooldown--;
  if(time%10===0) updateChronicle();
  updateUI();
  renderCity();
},1000);

updateChronicle();
updateUI();
renderCity();
</script>

</body>
</html>
