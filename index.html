<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Idle Realm</title>

<style>
:root{
  --bg:#0b1220;
  --card:#141c33;
  --card2:#1b2546;
  --accent:#2f6bff;
  --bronze:#c27c2c;
  --text:#e6ecff;
  --muted:#9aa4c7;
  --ok:#22c55e;
  --bad:#ef4444;
}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto}
body{margin:0;background:linear-gradient(180deg,#0a1020,#050a14);color:var(--text)}
header{
  position:sticky;top:0;z-index:10;
  background:#060b18;
  padding:8px 12px;
  display:flex;flex-wrap:wrap;gap:8px;justify-content:space-between;
  font-size:14px;
}
main{padding:16px;max-width:500px;margin:auto}
.card{background:linear-gradient(180deg,var(--card),var(--card2));border-radius:16px;padding:16px;margin-bottom:16px}
button{width:100%;border:none;border-radius:14px;padding:14px;margin-bottom:10px;background:var(--accent);color:white;font-size:16px}
button.bronze{background:linear-gradient(180deg,#e0a24c,#b87328);color:#1a0f00;font-weight:600}
button:disabled{opacity:.4}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.tile{background:#0f1730;border-radius:12px;height:70px;display:flex;align-items:center;justify-content:center;font-size:28px}
.small{font-size:13px;color:var(--muted)}
.obj{font-size:14px;margin-bottom:6px}
.obj.ok{color:var(--ok)}
.notice{background:#0f1730;padding:10px;border-radius:12px;font-size:13px;margin-top:8px}
</style>
</head>

<body>

<header>
  <span>ğŸ‘¥ <b id="pop"></b></span>
  <span>âš’ï¸ <b id="prod"></b></span>
  <span>ğŸ¥‰ <b id="bronze"></b></span>
  <span>ğŸ›¡ï¸ <b id="stab"></b>%</span>
  <span>â³ <b id="time"></b></span>
</header>

<main>
<h1>Idle Realm</h1>
<div class="small">A living world shaped by time and choices</div>

<div class="card">
  <h2>Era</h2>
  <div id="eraTitle"></div>
  <div id="eraDesc" class="small" style="margin-bottom:8px"></div>
  <div id="objectives"></div>
  <div id="eraNote" class="small"></div>

  <button id="advanceIron" class="bronze" style="display:none">
    âš”ï¸ Enter the Iron Age (50 ğŸ¥‰ / 20 âš’ï¸)
  </button>
</div>

<div class="card">
  <h2>Build</h2>
  <button id="btnSettle">ğŸ  Settlement (15 âš’ï¸)</button>
  <button id="btnWork">âš’ï¸ Workshop (20 âš’ï¸)</button>
  <button id="btnCouncil">ğŸ›ï¸ Council (30 âš’ï¸)</button>
  <button id="btnCouncil2">ğŸ›ï¸ Council II (30 ğŸ¥‰)</button>
  <div class="small" id="info"></div>
</div>

<div class="card">
  <h2>City</h2>
  <div class="grid" id="city"></div>
</div>

<div class="card">
  <h2>Events</h2>
  <div id="events"></div>
</div>
</main>

<script>
/* ===== CONFIG ===== */
let MAX_SLOTS = 12;
const COOLDOWN = 8;
const STABILITY_TARGET = 85;
const STABILITY_TIME_REQUIRED = 300; // 5 minutes

const COST = {
  settlement:15,
  workshop:20,
  council:30,
  council2:30
};

const DEFAULT = {
  era:"bronze",
  pop:20,
  prod:30,
  bronze:0,
  stab:80,
  time:0,
  lastAction:0,
  buildings:["âš’ï¸"],
  council2:false,
  stableTime:0,
  events:["â€¢ The Bronze Age begins"]
};

let state = loadState();

/* ===== LOAD / SAVE ===== */
function loadState(){
  try{
    const s = JSON.parse(localStorage.getItem("idleRealm"));
    if(!s) return structuredClone(DEFAULT);
    return Object.assign(structuredClone(DEFAULT), s);
  }catch{
    return structuredClone(DEFAULT);
  }
}
function save(){
  localStorage.setItem("idleRealm", JSON.stringify(state));
}
function log(msg){
  state.events.unshift("â€¢ "+msg);
  state.events = state.events.slice(0,10);
}
function canAct(){
  return Date.now() - state.lastAction >= COOLDOWN*1000;
}

/* ===== UPDATE ===== */
function update(){
  pop.innerText = state.pop.toFixed(0);
  prod.innerText = state.prod.toFixed(1);
  bronze.innerText = state.bronze.toFixed(1);
  state.stab = Math.max(0, Math.min(100, state.stab));
  stab.innerText = state.stab.toFixed(0);
  time.innerText = state.time;

  eraTitle.innerHTML = "<b>Bronze Age</b>";
  eraDesc.innerText = "Growth slows. Governance matters.";

  objectives.innerHTML = "";

  // Stability objective
  let stabText = state.stableTime > 0
    ? `Stability holding: ${Math.floor(state.stableTime/60)}:${String(state.stableTime%60).padStart(2,"0")} / 5:00`
    : "Maintain stability over time.";

  const stabDone = state.stableTime >= STABILITY_TIME_REQUIRED;
  objectives.innerHTML += `<div class="obj ${stabDone?"ok":""}">
    ${stabDone?"âœ”":"â˜"} Stability â‰¥ 85% (maintain for 5 minutes)
    <div class="small">${stabText}</div>
  </div>`;

  // Bronze objective
  const bronzeDone = state.bronze >= 75;
  objectives.innerHTML += `<div class="obj ${bronzeDone?"ok":""}">
    ${bronzeDone?"âœ”":"â˜"} Bronze â‰¥ 75
  </div>`;

  // Council II objective
  objectives.innerHTML += `<div class="obj ${state.council2?"ok":""}">
    ${state.council2?"âœ”":"â˜"} Council II established
  </div>`;

  eraNote.innerText = "A stable society must prove itself over time.";

  // Iron Age button
  advanceIron.style.display =
    stabDone && bronzeDone && state.council2 ? "block" : "none";
  advanceIron.disabled = state.bronze < 50 || state.prod < 20;

  info.innerText = canAct() ? "Ready" : "Cooldownâ€¦";

  btnSettle.disabled = !canAct() || state.prod < COST.settlement || state.buildings.length >= MAX_SLOTS;
  btnWork.disabled = !canAct() || state.prod < COST.workshop || state.buildings.length >= MAX_SLOTS;
  btnCouncil.disabled = !canAct() || state.prod < COST.council || state.buildings.includes("ğŸ›ï¸");
  btnCouncil2.disabled = !canAct() || state.bronze < COST.council2 || state.council2;

  city.innerHTML = "";
  for(let i=0;i<MAX_SLOTS;i++){
    const t = document.createElement("div");
    t.className = "tile";
    t.innerText = state.buildings[i] || "â¬œ";
    city.appendChild(t);
  }

  events.innerHTML = state.events.map(e=>`<div>${e}</div>`).join("");
  save();
}

/* ===== ACTIONS ===== */
function build(type){
  if(!canAct()) return;

  if(type==="settlement"){
    state.prod -= COST.settlement;
    state.pop += 4;
    state.buildings.push("ğŸ ");
    log("Settlement constructed");
  }
  if(type==="workshop"){
    state.prod -= COST.workshop;
    state.buildings.push("âš’ï¸");
    log("Workshop constructed");
  }
  if(type==="council"){
    state.prod -= COST.council;
    state.stab += 10;
    state.buildings.push("ğŸ›ï¸");
    log("Council established");
  }
  if(type==="council2"){
    state.bronze -= COST.council2;
    state.council2 = true;
    log("Council II established");
  }
  state.lastAction = Date.now();
  update();
}

btnSettle.onclick = ()=>build("settlement");
btnWork.onclick = ()=>build("workshop");
btnCouncil.onclick = ()=>build("council");
btnCouncil2.onclick = ()=>build("council2");

/* ===== IRON AGE ===== */
advanceIron.onclick = ()=>{
  if(state.bronze < 50 || state.prod < 20) return;
  state.bronze -= 50;
  state.prod -= 20;
  state.era = "iron";
  log("The Iron Age begins. Old certainties fade.");
  update();
};

/* ===== TICK ===== */
setInterval(()=>{
  state.time++;

  const workshops = state.buildings.filter(b=>b==="âš’ï¸").length;

  state.prod += workshops * 0.15;
  if(state.stab >= 80){
    state.bronze += workshops * 0.05;
  }

  // Governance pressure
  let pressure = workshops * 0.04;
  if(state.council2) pressure *= 0.5;

  // Population effect
  if(state.pop >= 30){
    state.stab += 0.04;
  }else if(state.pop >= 20){
    pressure = 0;
  }

  state.stab -= pressure;

  // Stability timer
  if(state.stab >= STABILITY_TARGET){
    state.stableTime++;
  }else{
    state.stableTime = 0;
  }

  update();
},1000);

update();
</script>
</body>
</html>
