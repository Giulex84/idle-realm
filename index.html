<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Idle Realm</title>

<style>
:root{
  --bg:#0b1220;
  --card:#141c33;
  --card2:#1b2546;
  --accent:#2f6bff;
  --text:#e6ecff;
  --muted:#9aa4c7;
  --good:#5dff9b;
  --warn:#ffb84d;
}

*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto}

body{
  margin:0;
  background:linear-gradient(180deg,#0a1020,#050a14);
  color:var(--text);
}

header{
  position:sticky;
  top:0;
  background:#060b18;
  padding:8px 12px;
  display:flex;
  justify-content:space-between;
  font-size:13px;
  z-index:10;
}

main{padding:16px;max-width:520px;margin:auto}

.card{
  background:linear-gradient(180deg,var(--card),var(--card2));
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}

button{
  width:100%;
  border:none;
  border-radius:14px;
  padding:14px;
  margin-bottom:10px;
  background:var(--accent);
  color:white;
  font-size:16px;
}
button:disabled{opacity:.4}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}

.tile{
  background:#0f1730;
  border-radius:12px;
  height:70px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:28px;
}

.small{font-size:13px;color:var(--muted)}
.good{color:var(--good)}
.warn{color:var(--warn)}
</style>
</head>

<body>

<header>
  <span>ğŸ‘¥ <b id="pop"></b></span>
  <span>âš’ï¸ <b id="prod"></b></span>
  <span>ğŸ¥‰ <b id="bronze"></b></span>
  <span>ğŸ›¡ï¸ <b id="stab"></b>%</span>
</header>

<main>

<h1>Idle Realm</h1>
<div class="small">A living world shaped by time and choices</div>

<div class="card">
  <h2>Era â€” Bronze Age</h2>
  <div class="small">Expansion slows. Infrastructure must adapt.</div>
  <div style="margin-top:8px">
    <div id="objMine">â¬œ Build 1 Mine</div>
    <div id="objSmelter">â¬œ Build 1 Smelter</div>
    <div id="objBronze">â¬œ Produce 50 Bronze</div>
    <div id="objStab">â¬œ Maintain Stability â‰¥ 80%</div>
  </div>
</div>

<div class="card">
  <h2>Build</h2>
  <button id="btnSettlement">ğŸ  Settlement (40)</button>
  <button id="btnWorkshop">âš’ï¸ Workshop (60)</button>
  <button id="btnCouncil">ğŸ›ï¸ Council (80)</button>
  <button id="btnMine">â›ï¸ Mine (70)</button>
  <button id="btnSmelter">ğŸ”¥ Smelter (90)</button>
</div>

<div class="card">
  <h2>City</h2>
  <div class="grid" id="city"></div>
</div>

<div class="card">
  <h2>Advisor</h2>
  <div id="advice" class="small"></div>
</div>

<div class="card">
  <h2>Events</h2>
  <div id="events"></div>
</div>

</main>

<script>
/* ===== STATE ===== */
const MAX_SLOTS = 9;
const COOLDOWN = 8;

const state = JSON.parse(localStorage.getItem("idleRealm")) || {
  pop:24,
  prod:30,
  bronze:0,
  stab:85,
  lastAction:0,
  buildings:["âš’ï¸","ğŸ ","ğŸ ","ğŸ›ï¸"],
  events:["â€¢ The Bronze Age begins"],
  lastTick:Date.now()
};

function save(){ localStorage.setItem("idleRealm",JSON.stringify(state)); }
function log(t){ state.events.unshift("â€¢ "+t); state.events=state.events.slice(0,10); }

function canAct(){ return Date.now()-state.lastAction>=COOLDOWN*1000; }

/* ===== BUILD ===== */
function build(type,cost,icon){
  if(!canAct()||state.prod<cost||state.buildings.length>=MAX_SLOTS) return;
  state.prod-=cost;
  state.buildings.push(icon);
  state.lastAction=Date.now();

  if(type==="settlement"){ state.pop+=4; state.stab-=2; }
  if(type==="workshop"){ }
  if(type==="council"){ state.stab+=5; }
  if(type==="mine"){ state.stab-=3; }
  if(type==="smelter"){ }

  log(type+" constructed");
  update();
}

/* ===== PRODUCTION LOOP ===== */
setInterval(()=>{
  const now=Date.now();
  const dt=(now-state.lastTick)/1000;
  state.lastTick=now;

  const workshops=state.buildings.filter(b=>b==="âš’ï¸").length;
  const mines=state.buildings.filter(b=>b==="â›ï¸").length;
  const smelters=state.buildings.filter(b=>"ğŸ”¥"===b).length;

  const popBonus=1+Math.floor(state.pop/10)*0.05;

  state.prod += workshops*0.4*popBonus*dt;
  state.bronze += Math.min(mines,smelters)*0.15*dt;

  if(state.stab<100) state.stab+=0.02*dt;

  update();
},1000);

/* ===== UI ===== */
function update(){
  pop.innerText=state.pop;
  prod.innerText=state.prod.toFixed(1);
  bronze.innerText=state.bronze.toFixed(1);
  stab.innerText=Math.round(state.stab);

  city.innerHTML="";
  for(let i=0;i<MAX_SLOTS;i++){
    const d=document.createElement("div");
    d.className="tile";
    d.innerText=state.buildings[i]||"â¬œ";
    city.appendChild(d);
  }

  events.innerHTML=state.events.map(e=>`<div>${e}</div>`).join("");

  btnSettlement.disabled=!canAct()||state.prod<40;
  btnWorkshop.disabled=!canAct()||state.prod<60;
  btnCouncil.disabled=!canAct()||state.prod<80||state.buildings.includes("ğŸ›ï¸");
  btnMine.disabled=!canAct()||state.prod<70;
  btnSmelter.disabled=!canAct()||state.prod<90;

  objMine.innerHTML=(state.buildings.includes("â›ï¸")?"âœ”":"â¬œ")+" Build 1 Mine";
  objSmelter.innerHTML=(state.buildings.includes("ğŸ”¥")?"âœ”":"â¬œ")+" Build 1 Smelter";
  objBronze.innerHTML=(state.bronze>=50?"âœ”":"â¬œ")+" Produce 50 Bronze";
  objStab.innerHTML=(state.stab>=80?"âœ”":"â¬œ")+" Maintain Stability â‰¥ 80%";

  advice.innerText=getAdvice();
  save();
}

/* ===== ADVICE ===== */
function getAdvice(){
  if(!state.buildings.includes("â›ï¸")) return "Mining capacity is required to extract raw materials.";
  if(!state.buildings.includes("ğŸ”¥")) return "Ore stock without smelting will slow progress.";
  if(state.stab<80) return "Stability is fragile. Rapid expansion can be dangerous.";
  if(state.pop<30) return "A larger population improves long-term efficiency.";
  return "Your realm is stable. Prepare for what comes next.";
}

/* ===== BUTTONS ===== */
btnSettlement.onclick=()=>build("settlement",40,"ğŸ ");
btnWorkshop.onclick=()=>build("workshop",60,"âš’ï¸");
btnCouncil.onclick=()=>build("council",80,"ğŸ›ï¸");
btnMine.onclick=()=>build("mine",70,"â›ï¸");
btnSmelter.onclick=()=>build("smelter",90,"ğŸ”¥");

update();
</script>

</body>
</html>
