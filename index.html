<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Idle Realm</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:radial-gradient(circle at top,#0b1a33,#050914);
  color:#e8eefc;
}
header{
  display:flex;
  justify-content:space-around;
  padding:12px;
  background:rgba(0,0,0,.45);
  backdrop-filter:blur(6px);
  font-weight:600;
}
main{padding:16px;}
.card{
  background:rgba(255,255,255,.05);
  border-radius:16px;
  padding:14px;
  margin-bottom:16px;
}
.buttons{display:flex;flex-wrap:wrap;gap:10px;}
button{
  flex:1;
  min-width:140px;
  padding:14px;
  border-radius:12px;
  border:none;
  font-size:15px;
  font-weight:600;
  background:#2563eb;
  color:#fff;
}
button.locked{background:#334155;}
.city{font-family:monospace;font-size:18px;letter-spacing:2px;}
.log{font-size:14px;padding-left:18px;}
small{opacity:.7}
</style>
</head>

<body>

<header>
  <div>üë• <span id="pop">0</span></div>
  <div>‚öíÔ∏è <span id="prod">0</span></div>
  <div>üõ°Ô∏è <span id="stab">0</span>%</div>
  <div>‚è≥ <span id="era">Foundations</span></div>
</header>

<main>
<h1>Idle Realm</h1>
<small>A living world shaped by time and choices</small>

<div class="card">
<h2>Build</h2>
<div class="buttons">
  <button id="sBtn">üè† Settlement</button>
  <button id="wBtn">‚öíÔ∏è Workshop</button>
  <button id="cBtn">üèõÔ∏è Council</button>
</div>
<p id="hint"></p>
</div>

<div class="card">
<h2>City</h2>
<div class="city">
Residential: <span id="res"></span><br/>
Industrial: <span id="ind"></span><br/>
Government: <span id="gov"></span>
</div>
</div>

<div class="card">
<h2>Era</h2>
<p id="eraDesc"></p>
</div>

<div class="card">
<h2>Events</h2>
<ul id="log" class="log"></ul>
</div>
</main>

<script>
/* ========= STATE LOAD + MIGRATION ========= */
function safe(n, d){ return Number.isFinite(n) ? n : d; }

let raw = JSON.parse(localStorage.getItem("idleRealm")) || {};

let S = {
  pop: safe(raw.pop, 10),
  prod: safe(raw.prod, 10),
  stab: safe(raw.stab, 100),
  s: safe(raw.s, 0),
  w: safe(raw.w, 0),
  c: safe(raw.c, 0),
  era: safe(raw.era, 0),
  tick: safe(raw.tick, 0)
};

const ERAS = [
  {name:"Foundations", desc:"Slow growth. Every choice matters.", popCap:120},
  {name:"Expansion", desc:"Growth accelerates. Stability is fragile.", popCap:600}
];

const $ = id => document.getElementById(id);
const log = m => {
  const li=document.createElement("li");
  li.textContent=m;
  $("log").prepend(li);
};
const save = () => localStorage.setItem("idleRealm", JSON.stringify(S));

function cost(base,count){ return Math.floor(base * (1 + count * 0.35)); }

/* ========= ACTIONS ========= */
function build(type){
  if(type==="s"){
    const p=cost(8,S.s), stab=8;
    if(S.prod<p) return log("Not enough production");
    if(S.stab<stab) return log("Stability too low");
    S.prod-=p; S.pop+=4; S.stab-=stab; S.s++;
    log("Settlement built (+4 pop, -8 stab)");
  }
  if(type==="w"){
    const p=cost(12,S.w), stab=12;
    if(S.prod<p) return log("Not enough production");
    if(S.stab<stab) return log("Stability too low");
    S.prod-=p; S.prod+=2; S.stab-=stab; S.w++;
    log("Workshop built (+2 prod, -12 stab)");
  }
  if(type==="c"){
    if(S.c>=1) return log("Only one Council allowed");
    if(S.prod<25) return log("Not enough production");
    S.prod-=25; S.stab+=20; S.c=1;
    log("Council built (+20 stability)");
  }
}

/* ========= UI ========= */
function update(){
  $("pop").textContent=S.pop.toFixed(1);
  $("prod").textContent=S.prod.toFixed(1);
  $("stab").textContent=Math.max(0,Math.min(100,S.stab)).toFixed(0);
  $("era").textContent=ERAS[S.era].name;
  $("eraDesc").textContent=ERAS[S.era].desc;

  $("res").textContent="‚ñ†".repeat(S.s);
  $("ind").textContent="‚ñ†".repeat(S.w);
  $("gov").textContent=S.c?"‚ñ†":"";

  $("hint").innerHTML =
    `<small>Settlement: ${cost(8,S.s)} prod<br/>
     Workshop: ${cost(12,S.w)} prod</small>`;

  save();
}

/* ========= LOOP ========= */
setInterval(()=>{
  S.tick++;
  S.prod += S.w * 0.4;
  S.pop = Math.min(S.pop + S.s * 0.2, ERAS[S.era].popCap);
  S.stab = Math.min(100, S.stab + 0.15);

  if(S.era===0 && S.pop>80 && S.s>=3){
    S.era=1;
    log("‚ö° Era advanced: Expansion");
  }
  update();
},1000);

/* ========= BIND ========= */
$("sBtn").onclick=()=>build("s");
$("wBtn").onclick=()=>build("w");
$("cBtn").onclick=()=>build("c");

update();
</script>

</body>
</html>
