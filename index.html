<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Idle Realm</title>

<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: radial-gradient(circle at top, #0e1a33, #060b1a);
    color: #eaeaf0;
  }

  .topbar {
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 8px;
    background: rgba(0,0,0,0.4);
    font-size: 14px;
  }

  .container {
    padding: 16px;
  }

  h1 {
    margin-top: 10px;
    font-size: 28px;
  }

  .subtitle {
    opacity: 0.8;
    margin-bottom: 20px;
  }

  .card {
    background: rgba(255,255,255,0.05);
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 20px;
  }

  .build-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }

  button {
    border: none;
    border-radius: 14px;
    padding: 14px;
    font-size: 16px;
    font-weight: 600;
    background: #2d6cff;
    color: white;
  }

  button:disabled {
    background: #2a3555;
    opacity: 0.5;
  }

  .city-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
  }

  .tile {
    background: rgba(255,255,255,0.06);
    border-radius: 14px;
    height: 70px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
  }

  .events {
    font-size: 14px;
    opacity: 0.9;
  }

  .cooldown {
    color: #ffd166;
    margin-top: 8px;
    font-weight: 600;
  }
</style>
</head>

<body>

<div class="topbar">
  <div>üë• <span id="pop">10</span></div>
  <div>üõ† <span id="prod">0</span></div>
  <div>üõ° <span id="stab">100</span>%</div>
  <div>‚è≥ <span id="time">0</span></div>
</div>

<div class="container">
  <h1>Idle Realm</h1>
  <div class="subtitle">A living world shaped by time and choices</div>

  <div class="card">
    <h2>Build</h2>
    <div class="build-grid">
      <button id="settlementBtn">üè† Settlement</button>
      <button id="workshopBtn">üõ† Workshop</button>
      <button id="councilBtn">üèõ Council</button>
    </div>
    <div class="cooldown" id="cooldownText"></div>
    <div style="margin-top:8px; font-size:14px;">
      Settlement: 15 prod<br>
      Workshop: 20 prod<br>
      Council: 30 prod
    </div>
  </div>

  <div class="card">
    <h2>City</h2>
    <div class="city-grid" id="cityGrid"></div>
  </div>

  <div class="card">
    <h2>Era</h2>
    <div id="eraText">
      <b>Age of Clans</b><br>
      Small settlements. Fragile balance. Slow growth.
    </div>
  </div>

  <div class="card">
    <h2>Events</h2>
    <div class="events" id="events"></div>
  </div>
</div>

<script>
/* ===== GAME STATE ===== */
let population = 10;
let production = 0;
let stability = 100;
let time = 0;

let settlements = 0;
let workshops = 0;
let councils = 0;

let citySlots = Array(9).fill(null);

let cooldown = 0;
const COOLDOWN_MAX = 8;

/* ===== HELPERS ===== */
function logEvent(text) {
  const el = document.getElementById("events");
  el.innerHTML = "‚Ä¢ " + text + "<br>" + el.innerHTML;
}

function updateUI() {
  document.getElementById("pop").textContent = population.toFixed(1);
  document.getElementById("prod").textContent = production.toFixed(1);
  document.getElementById("stab").textContent = Math.max(0, Math.min(100, stability)).toFixed(0);
  document.getElementById("time").textContent = time;

  document.getElementById("settlementBtn").disabled = !canBuild("settlement");
  document.getElementById("workshopBtn").disabled = !canBuild("workshop");
  document.getElementById("councilBtn").disabled = !canBuild("council");

  document.getElementById("cooldownText").textContent =
    cooldown > 0 ? `Cooldown: ${cooldown}s` : "";
}

/* ===== ECONOMY ===== */
function productionPerSecond() {
  const base = 0.15;
  const workshopProd = Math.pow(workshops, 0.85) * 0.8;
  return base + workshopProd;
}

/* ===== BUILD RULES ===== */
function emptySlotIndex() {
  return citySlots.findIndex(s => s === null);
}

function canBuild(type) {
  if (cooldown > 0) return false;
  if (emptySlotIndex() === -1) return false;

  if (type === "settlement") return production >= 15;
  if (type === "workshop") return production >= 20;
  if (type === "council") return production >= 30 && councils === 0;

  return false;
}

function build(type) {
  if (!canBuild(type)) {
    logEvent("Action blocked");
    return;
  }

  cooldown = COOLDOWN_MAX;

  const slot = emptySlotIndex();
  if (slot === -1) return;

  if (type === "settlement") {
    production -= 15;
    population += 4;
    stability -= 6;
    settlements++;
    citySlots[slot] = "üè†";
    logEvent("Settlement built (+4 pop, -6 stability)");
  }

  if (type === "workshop") {
    production -= 20;
    workshops++;
    stability -= 4;
    citySlots[slot] = "üõ†";
    logEvent("Workshop built (+production)");
  }

  if (type === "council") {
    production -= 30;
    councils++;
    stability += 20;
    citySlots[slot] = "üèõ";
    logEvent("Council established (+20 stability)");
  }

  renderCity();
  updateUI();
}

/* ===== CITY ===== */
function renderCity() {
  const grid = document.getElementById("cityGrid");
  grid.innerHTML = "";
  citySlots.forEach(s => {
    const d = document.createElement("div");
    d.className = "tile";
    d.textContent = s || "";
    grid.appendChild(d);
  });
}

/* ===== BUTTONS ===== */
document.getElementById("settlementBtn").onclick = () => build("settlement");
document.getElementById("workshopBtn").onclick = () => build("workshop");
document.getElementById("councilBtn").onclick = () => build("council");

/* ===== GAME LOOP ===== */
setInterval(() => {
  time++;
  production += productionPerSecond();
  if (cooldown > 0) cooldown--;
  updateUI();
}, 1000);

renderCity();
updateUI();
</script>

</body>
</html>
