<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Idle Realm</title>

<style>
:root{
  --bg:#0b1220;
  --card:#141c33;
  --card2:#1b2545;
  --accent:#3b82f6;
  --danger:#fb7185;
  --text:#e6ecff;
  --muted:#9aa4c7;
  --ok:#22c55e;
}
*{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto}
body{
  margin:0;
  background:linear-gradient(180deg,#0a1020,#050814);
  color:var(--text);
}

/* ---------- ONBOARDING ---------- */
#onboarding{
  position:fixed;
  inset:0;
  background:linear-gradient(180deg,#060b18,#02040a);
  z-index:9999;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}
#onboarding.hidden{display:none}
.on-card{
  max-width:520px;
  background:linear-gradient(180deg,var(--card),var(--card2));
  border-radius:18px;
  padding:20px;
}
.on-card h2{margin-top:0}
.on-scroll{
  max-height:260px;
  overflow:auto;
  font-size:13px;
  color:var(--muted);
  background:#0f1730;
  padding:12px;
  border-radius:12px;
  margin-bottom:12px;
}
label{font-size:14px}
button{
  width:100%;
  border:none;
  border-radius:14px;
  padding:14px;
  background:var(--accent);
  color:white;
  font-size:16px;
}
button:disabled{opacity:.4}

/* ---------- GAME ---------- */
header{
  position:sticky;top:0;z-index:10;
  background:#060b18;
  padding:8px 12px;
  display:flex;
  justify-content:space-between;
  font-size:14px;
}
main{padding:16px;max-width:520px;margin:auto}
.card{
  background:linear-gradient(180deg,var(--card),var(--card2));
  border-radius:18px;
  padding:16px;
  margin-bottom:18px;
}
.small{font-size:13px;color:var(--muted)}
.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}
.tile{
  height:72px;
  border-radius:14px;
  background:#0f1730;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:28px;
}
.ok{color:var(--ok)}
.danger{background:var(--danger)}
.check{margin:6px 0}
</style>
</head>

<body>

<!-- ================= ONBOARDING ================= -->
<div id="onboarding">
  <div class="on-card">
    <h2>Terms of Service & Privacy Policy</h2>

    <div class="on-scroll">
      <b>Terms of Service</b><br><br>
      Idle Realm is provided ‚Äúas is‚Äù for entertainment purposes only.<br>
      The game is free to play and contains no payments or advertisements.<br>
      Game mechanics and balance may change during development.<br><br>

      <b>Privacy Policy</b><br><br>
      Idle Realm does not collect, store, or transmit personal data.<br>
      No analytics, cookies, or tracking services are used.<br>
      All game progress is stored locally on your device only.<br>
      No data is shared with third parties.
    </div>

    <label>
      <input type="checkbox" id="acceptChk" />
      I have read and agree to the Terms of Service and Privacy Policy
    </label>

    <br><br>
    <button id="continueBtn" disabled>Continue to Idle Realm</button>
  </div>
</div>

<!-- ================= GAME ================= -->
<header>
  <span>üë• <b id="pop"></b></span>
  <span>üõ† <b id="tools"></b></span>
  <span>üõ° <b id="stab"></b>%</span>
  <span>‚è≥ <b id="time"></b></span>
</header>

<main>
  <h1>Idle Realm</h1>
  <div class="small">A strategic realm shaped by irreversible choices</div>

  <div class="card">
    <h2>Era</h2>
    <b id="eraName"></b>
    <div class="small" id="eraDesc"></div>
  </div>

  <div class="card">
    <h2>Era Objectives</h2>
    <div id="objectives"></div>
    <button id="advanceBtn" disabled>Advance Era</button>
  </div>

  <div class="card">
    <h2>Decisions</h2>
    <div id="decisions"></div>
  </div>

  <div class="card">
    <h2>City</h2>
    <div class="grid" id="city"></div>
  </div>

  <div class="card">
    <h2>Chronicle</h2>
    <div id="log" class="small"></div>
  </div>

  <div class="card">
    <button class="danger" onclick="resetGame()">Reset Progress (Review Mode)</button>
    <div class="small">Temporary. Will be removed after review.</div>
  </div>
</main>

<script>
/* ================= PI AUTH SAFE ================= */
const PiSDK = window.Pi || { authenticate: async()=>({user:{uid:"review"}}) };
PiSDK.authenticate();

/* ================= TERMS GATE ================= */
const TERMS_KEY="idleRealm_termsAccepted";
const onboarding=document.getElementById("onboarding");
if(localStorage.getItem(TERMS_KEY)==="true"){
  onboarding.classList.add("hidden");
}
acceptChk.onchange=()=>continueBtn.disabled=!acceptChk.checked;
continueBtn.onclick=()=>{
  localStorage.setItem(TERMS_KEY,"true");
  onboarding.classList.add("hidden");
};

/* ================= GAME DATA ================= */
const ERAS=[
 {id:1,name:"Foundations",desc:"The birth of order and governance.",
  unlock:["FAMILY","WORKSHOP","COUNCIL"],
  obj:{FAMILY:2,WORKSHOP:1,stability:90}},
 {id:2,name:"Age of Bronze",desc:"Industry and specialization emerge.",
  unlock:["MINE","SMELTER"],
  obj:{MINE:1,SMELTER:1,bronze:50,stability:80}},
 {id:3,name:"Iron Age (Preparation)",desc:"External pressure is anticipated.",
  unlock:["FORGE"],
  obj:{iron:30,stability:
