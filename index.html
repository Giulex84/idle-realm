<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Idle Realm</title>

<style>
:root{
  --bg:#0b1220;--card:#141c33;--card2:#1b2546;
  --accent:#3b6cff;--bronze:#c27c2c;
  --text:#e6ecff;--muted:#9aa4c7;
  --ok:#22c55e;--bad:#ef4444;
}
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:linear-gradient(180deg,#0a1020,#050a14);color:var(--text)}
header{
  position:sticky;top:0;z-index:10;
  background:#060b18;padding:8px 12px;
  display:flex;flex-wrap:wrap;gap:10px;justify-content:space-between;font-size:14px
}
main{padding:16px;max-width:520px;margin:auto}
.card{background:linear-gradient(180deg,var(--card),var(--card2));border-radius:16px;padding:16px;margin-bottom:16px}
button{width:100%;border:none;border-radius:14px;padding:14px;margin-bottom:10px;background:var(--accent);color:white;font-size:16px;font-weight:600}
button.bronze{background:linear-gradient(180deg,#e0a24c,#b87328);color:#1a0f00}
button:disabled{opacity:.45}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.tile{
  background:#0f1730;border-radius:12px;height:70px;
  display:flex;align-items:center;justify-content:center;font-size:28px;
  cursor:pointer
}
.small{color:var(--muted);font-size:13px}
.obj{font-size:14px;margin-bottom:6px}
.obj.ok{color:var(--ok)}
</style>
</head>

<body>
<header>
<span>üë• <b id="pop"></b></span>
<span>‚öíÔ∏è <b id="prod"></b></span>
<span>ü•â <b id="bronze"></b></span>
<span>üõ°Ô∏è <b id="stab"></b>%</span>
<span>‚è≥ <b id="time"></b></span>
</header>

<main>
<h1>Idle Realm</h1>
<div class="small">A living world shaped by time and choices</div>

<div class="card">
<h2>Era</h2>
<div id="eraTitle"></div>
<div id="eraDesc" class="small"></div>
<div id="objectives"></div>
<button id="advanceEra" class="bronze" style="display:none"></button>
</div>

<div class="card">
<h2>Build</h2>
<button id="btnSettlement"></button>
<button id="btnWorkshop"></button>
<button id="btnMine"></button>
<button id="btnCouncil"></button>
<button id="btnCouncil2"></button>
<div id="info" class="small"></div>
</div>

<div class="card">
<h2>City</h2>
<div id="city" class="grid"></div>
<div class="small">Tap a building to remove it (no refund).</div>
</div>

<div class="card">
<h2>Events</h2>
<div id="events"></div>
</div>
</main>

<script>
/* ===== CONFIG ===== */
let MAX_SLOTS=9;
const COOLDOWN=8;
const ERA2_COST=50;
const COST={settlement:15,workshop:20,mine:20,council:30,council2:30};

/* ===== DEFAULT ===== */
const DEFAULT={
  era:"foundations",pop:12,prod:30,bronze:0,stab:100,time:0,
  lastAction:0,lastSeen:Date.now(),bronzeStableTime:0,
  buildings:["‚öíÔ∏è"],events:["Realm founded with basic craftsmanship"]
};
let state=load();

/* ===== LOAD/SAVE ===== */
function load(){
  try{
    const s=JSON.parse(localStorage.getItem("idleRealm"));
    if(!s||!["foundations","bronze","iron"].includes(s.era))throw "";
    return Object.assign(structuredClone(DEFAULT),s);
  }catch{return structuredClone(DEFAULT)}
}
function save(){state.lastSeen=Date.now();localStorage.setItem("idleRealm",JSON.stringify(state))}

/* ===== UTIL ===== */
function canAct(){return Date.now()-state.lastAction>=COOLDOWN*1000}
function log(m){state.events.unshift("‚Ä¢ "+m);state.events=state.events.slice(0,10)}

/* ===== OBJECTIVES ===== */
function eraObjectives(){
  if(state.era==="foundations")return[
    ["Build 3 Settlements",state.buildings.filter(b=>b==="üè†").length>=3],
    ["Reach 50 Production",state.prod>=50],
    ["Establish the Council",state.buildings.includes("üèõÔ∏è")],
    ["Stability ‚â• 70%",state.stab>=70]
  ];
  if(state.era==="bronze")return[
    ["Stability ‚â• 85% (maintain for 5 minutes)",state.bronzeStableTime>=300],
    ["Bronze ‚â• 75",state.bronze>=75],
    ["Council II established",state.buildings.includes("üèõÔ∏èüèõÔ∏è")]
  ];
  return [];
}
function eraComplete(){return eraObjectives().every(o=>o[1])}

/* ===== UPDATE ===== */
function update(){
  pop.textContent=state.pop;
  prod.textContent=state.prod.toFixed(1);
  bronze.textContent=state.bronze.toFixed(1);
  stab.textContent=Math.min(100,state.stab).toFixed(0);
  time.textContent=state.time;

  eraTitle.innerHTML="<b>"+(state.era==="foundations"?"Foundations":state.era==="bronze"?"Bronze Age":"Iron Age")+"</b>";
  eraDesc.textContent=state.era==="foundations"?"Fast growth to learn the game."
    :state.era==="bronze"?"Growth slows. Governance matters."
    :"A harsher world emerges.";

  objectives.innerHTML="";
  eraObjectives().forEach(o=>{
    const d=document.createElement("div");
    d.className="obj"+(o[1]?" ok":"");
    if(o[0].includes("Stability")&&state.era==="bronze"){
      const t=Math.min(300,state.bronzeStableTime);
      d.innerHTML=`${o[1]?"‚úî":"‚òê"} ${o[0]}<br><span class="small">${Math.floor(t/60)}:${String(t%60).padStart(2,"0")} / 5:00</span>`;
    }else d.textContent=(o[1]?"‚úî ":"‚òê ")+o[0];
    objectives.appendChild(d);
  });

  advanceEra.style.display=eraComplete()?"block":"none";
  advanceEra.textContent=state.era==="foundations"?"Enter the Bronze Age (50 ‚öíÔ∏è)":"Enter the Iron Age (100 ‚öíÔ∏è)";
  advanceEra.disabled=state.prod<(state.era==="foundations"?50:100);

  btnSettlement.textContent="üè† Settlement (15 ‚öíÔ∏è)";
  btnWorkshop.textContent="‚öíÔ∏è Workshop (20 ‚öíÔ∏è)";
  btnMine.textContent="‚õèÔ∏è Mine (20 ‚öíÔ∏è)";
  btnCouncil.textContent="üèõÔ∏è Council (30 ‚öíÔ∏è)";
  btnCouncil2.textContent="üèõÔ∏èüèõÔ∏è Council II (30 ü•â)";

  btnSettlement.disabled=!canAct()||state.prod<15||state.buildings.length>=MAX_SLOTS;
  btnWorkshop.disabled=!canAct()||state.prod<20||state.buildings.length>=MAX_SLOTS;
  btnMine.disabled=state.era!=="bronze"||!canAct()||state.prod<20||state.buildings.length>=MAX_SLOTS;
  btnCouncil.disabled=!canAct()||state.prod<30||state.buildings.includes("üèõÔ∏è");
  btnCouncil2.disabled=state.era!=="bronze"||!canAct()||state.bronze<30||state.buildings.includes("üèõÔ∏èüèõÔ∏è");

  city.innerHTML="";
  state.buildings.forEach((b,i)=>{
    const t=document.createElement("div");
    t.className="tile";t.textContent=b;
    t.onclick=()=>removeBuilding(i);
    city.appendChild(t);
  });
  for(let i=state.buildings.length;i<MAX_SLOTS;i++){
    const t=document.createElement("div");
    t.className="tile";city.appendChild(t);
  }

  events.innerHTML=state.events.map(e=>`<div>${e}</div>`).join("");
  save();
}

/* ===== BUILD / REMOVE ===== */
function build(type){
  if(!canAct())return;
  if(type==="settlement"){state.prod-=15;state.pop+=4;state.stab-=6;state.buildings.push("üè†");log("Settlement built")}
  if(type==="workshop"){state.prod-=20;state.buildings.push("‚öíÔ∏è");log("Workshop built")}
  if(type==="mine"){state.prod-=20;state.stab-=4;state.buildings.push("‚õèÔ∏è");log("Mine constructed")}
  if(type==="council"){state.prod-=30;state.stab+=15;state.buildings.push("üèõÔ∏è");log("Council established")}
  if(type==="council2"){state.bronze-=30;state.stab+=10;state.buildings.push("üèõÔ∏èüèõÔ∏è");log("Council II established")}
  state.lastAction=Date.now();update();
}
function removeBuilding(i){
  if(state.era==="foundations")return;
  const b=state.buildings[i];
  if(b==="üè†")state.pop-=4;
  if(b==="‚õèÔ∏è")state.stab+=2;
  state.buildings.splice(i,1);
  log(b+" removed");
  update();
}

/* ===== BUTTONS ===== */
btnSettlement.onclick=()=>build("settlement");
btnWorkshop.onclick=()=>build("workshop");
btnMine.onclick=()=>build("mine");
btnCouncil.onclick=()=>build("council");
btnCouncil2.onclick=()=>build("council2");
advanceEra.onclick=()=>{
  if(state.era==="foundations"){state.prod-=50;state.era="bronze";MAX_SLOTS=12;log("The Bronze Age begins")}
  else if(state.era==="bronze"){state.prod-=100;state.era="iron";log("The Iron Age begins")}
  update();
};

/* ===== TICK ===== */
setInterval(()=>{
  state.time++;
  const w=state.buildings.filter(b=>b==="‚öíÔ∏è").length;
  const m=state.buildings.filter(b=>b==="‚õèÔ∏è").length;
  const c=state.buildings.includes("üèõÔ∏è");
  const c2=state.buildings.includes("üèõÔ∏èüèõÔ∏è");

  state.prod+=w*0.25;

  if(state.era==="bronze"&&m>0){
    state.bronze+=m*0.025*(1+w*0.3);
  }

  if(state.era==="bronze"){
    let g=-0.05*w-0.08*m;
    if(state.pop>=20)g+=0.05;
    if(state.pop>=30)g+=0.08;
    if(c)g+=0.05;
    if(c2)g+=0.1;
    state.stab=Math.max(0,Math.min(100,state.stab+g));
    if(state.stab>=85)state.bronzeStableTime++;
  }
  update();
},1000);

update();
</script>
</body>
</html>
