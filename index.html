<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Giulex Hub – Testnet</title>

<!-- Pi SDK -->
<script src="https://sdk.minepi.com/pi-sdk.js"></script>

<script>
  Pi.init({
    version: "2.0",
    sandbox: true
  });
</script>

<style>
body {
  background: #0a0f1f;
  color: #e6eaff;
  font-family: monospace;
  padding: 24px;
}
button {
  padding: 12px 16px;
  margin-right: 8px;
  margin-bottom: 12px;
  font-size: 14px;
}
pre {
  background: #000;
  padding: 12px;
  min-height: 200px;
}
</style>
</head>

<body>

<h1>Giulex Hub – Testnet</h1>
<p>Pi SDK ready (Testnet)</p>

<button onclick="authenticate()">Authenticate</button>
<button onclick="pay()">Pay 1 Test-Pi</button>

<pre id="log"></pre>

<script>
let currentUser = null;

function log(msg) {
  document.getElementById("log").textContent += msg + "\n";
}
</script>

<script>
async function authenticate() {
  log("Authenticating...");

  try {
    const scopes = ["username", "payments"];

    const auth = await Pi.authenticate(
      scopes,
      onIncompletePaymentFound
    );

    currentUser = auth.user;
    log("Authenticated: " + currentUser.username);

  } catch (e) {
    log("AUTH ERROR: " + e);
  }
}

function onIncompletePaymentFound(payment) {
  log("Incomplete payment found: " + payment.identifier);
}
</script>

<script>
async function pay() {
  if (!currentUser) {
    log("ERROR: authenticate first");
    return;
  }

  log("Creating payment...");

  try {
    const payment = await Pi.createPayment(
      {
        amount: 1,
        memo: "Test payment",
        metadata: { app: "giulex-hub-test" }
      },
      {
        onReadyForServerApproval,
        onReadyForServerCompletion,
        onCancel,
        onError
      }
    );

    log("Payment created: " + payment.identifier);

  } catch (e) {
    log("PAY ERROR: " + e);
  }
}

function onReadyForServerApproval(paymentId) {
  log("Ready for approval: " + paymentId);
}

function onReadyForServerCompletion(paymentId, txid) {
  log("Completed: " + paymentId + " tx: " + txid);
}

function onCancel(paymentId) {
  log("Canceled: " + paymentId);
}

function onError(err) {
  log("Payment error: " + err);
}
</script>

</body>
</html>
