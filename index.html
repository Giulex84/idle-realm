<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Idle Realm</title>

<style>
:root{
  --bg:#0b1220;
  --card:#141c33;
  --card2:#1b2546;
  --accent:#2f6bff;
  --text:#e6ecff;
  --muted:#9aa4c7;
  --ok:#22c55e;
  --warn:#f59e0b;
}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto}
body{margin:0;background:linear-gradient(180deg,#0a1020,#050a14);color:var(--text)}
header{position:sticky;top:0;background:#060b18;padding:8px 12px;display:flex;justify-content:space-between;font-size:13px}
main{padding:16px;max-width:520px;margin:auto}
.card{background:linear-gradient(180deg,var(--card),var(--card2));border-radius:16px;padding:16px;margin-bottom:16px}
button{width:100%;border:none;border-radius:14px;padding:14px;margin-bottom:6px;background:var(--accent);color:white;font-size:16px}
button:disabled{opacity:.4}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.tile{background:#0f1730;border-radius:12px;height:70px;display:flex;align-items:center;justify-content:center;font-size:28px}
.small{font-size:13px;color:var(--muted)}
.ok{color:var(--ok)}
.warn{color:var(--warn)}
</style>
</head>

<body>

<header>
  <span id="hPop"></span>
  <span id="hProd"></span>
  <span id="hStab"></span>
</header>

<main>

<h1>Idle Realm</h1>
<div class="small">A living world shaped by time and choices</div>

<div class="card">
  <h2>Foundations</h2>
  <div class="small">Build slowly. Learn the rules of the realm.</div>
  <div id="objectives" style="margin-top:8px"></div>
  <button id="advanceEra">Advance to Bronze Age (50 ‚öíÔ∏è)</button>
</div>

<div class="card">
  <h2>Build</h2>
  <button id="btnSettlement">üè† Settlement (15)</button>
  <button id="btnWorkshop">‚öíÔ∏è Workshop (20)</button>
  <button id="btnCouncil">üèõÔ∏è Council (30)</button>
  <div id="cooldownInfo" class="small"></div>
</div>

<div class="card">
  <h2>City</h2>
  <div class="grid" id="city"></div>
</div>

<div class="card">
  <h2>Advisor</h2>
  <div id="advisor" class="small"></div>
</div>

<div class="card">
  <h2>Events</h2>
  <div id="events"></div>
</div>

</main>

<script>
/* ===== ERA 1 ONLY ===== */

const MAX_SLOTS = 9;
const COOLDOWN = 8;

const state = JSON.parse(localStorage.getItem("idleRealm")) || {
  era: "foundations",
  pop:12,
  prod:30,
  stab:100,
  lastAction:0,
  buildings:["‚öíÔ∏è"],
  events:["‚Ä¢ The realm is founded"]
};

function save(){ localStorage.setItem("idleRealm",JSON.stringify(state)); }
function log(t){ state.events.unshift("‚Ä¢ "+t); state.events=state.events.slice(0,10); }
function canAct(){ return Date.now()-state.lastAction>=COOLDOWN*1000; }
function cooldownLeft(){
  const left = COOLDOWN*1000-(Date.now()-state.lastAction);
  return Math.max(0, Math.ceil(left/1000));
}

/* ===== BUILD ===== */
function build(type){
  if(!canAct()) return;

  if(type==="settlement" && state.prod>=15){
    state.prod-=15;
    state.pop+=4;
    state.stab-=6;
    state.buildings.push("üè†");
  }
  if(type==="workshop" && state.prod>=20){
    state.prod-=20;
    state.buildings.push("‚öíÔ∏è");
  }
  if(type==="council" && state.prod>=30 && !state.buildings.includes("üèõÔ∏è")){
    state.prod-=30;
    state.stab+=15;
    state.buildings.push("üèõÔ∏è");
  }

  state.lastAction=Date.now();
  log(type+" built");
  update();
}

/* ===== OBJECTIVES ===== */
function objectives(){
  return [
    ["Population ‚â• 6", state.pop>=6],
    ["Build 3 Settlements", state.buildings.filter(b=>b==="üè†").length>=3],
    ["Production ‚â• 50", state.prod>=50],
    ["Council built", state.buildings.includes("üèõÔ∏è")],
    ["Stability ‚â• 80%", state.stab>=80]
  ];
}

/* ===== LOOP ===== */
setInterval(()=>{
  const workshops = state.buildings.filter(b=>b==="‚öíÔ∏è").length;
  const popBonus = 1 + Math.floor(state.pop/4)*0.05;
  state.prod += workshops * 0.4 * popBonus;
  if(state.stab<100) state.stab+=0.08;
  update();
},1000);

/* ===== ERA ADVANCE ===== */
advanceEra.onclick = ()=>{
  if(!objectives().every(o=>o[1])) return;
  if(state.prod < 50) return;
  state.prod -= 50;
  state.era = "bronze";
  log("The Bronze Age begins");
  update();
};

/* ===== UI ===== */
function update(){
  hPop.innerText="üë• "+state.pop;
  hProd.innerText="‚öíÔ∏è "+state.prod.toFixed(1);
  hStab.innerText="üõ°Ô∏è "+Math.round(state.stab)+"%";

  objectivesEl.innerHTML="";
  objectives().forEach(o=>{
    objectivesEl.innerHTML+=`<div class="${o[1]?"ok":"warn"}">${o[1]?"‚úî":"‚¨ú"} ${o[0]}</div>`;
  });

  const ready = objectives().every(o=>o[1]);
  advanceEra.style.display = ready ? "block" : "none";
  advanceEra.disabled = state.prod < 50;

  cooldownInfo.innerText = canAct()
    ? "Actions ready"
    : "Cooldown: "+cooldownLeft()+"s";

  btnSettlement.disabled=!canAct()||state.prod<15;
  btnWorkshop.disabled=!canAct()||state.prod<20;
  btnCouncil.disabled=!canAct()||state.prod<30||state.buildings.includes("üèõÔ∏è");

  city.innerHTML="";
  for(let i=0;i<MAX_SLOTS;i++){
    const d=document.createElement("div");
    d.className="tile";
    d.innerText=state.buildings[i]||"‚¨ú";
    city.appendChild(d);
  }

  advisor.innerText =
    state.buildings.filter(b=>b==="üè†").length<3 ? "Settlements increase long-term growth." :
    !state.buildings.includes("üèõÔ∏è") ? "A council will stabilize your society." :
    "Your foundations are complete.";

  events.innerHTML=state.events.map(e=>`<div>${e}</div>`).join("");
  save();
}

btnSettlement.onclick=()=>build("settlement");
btnWorkshop.onclick=()=>build("workshop");
btnCouncil.onclick=()=>build("council");

const objectivesEl=document.getElementById("objectives");
update();
</script>

</body>
</html>
