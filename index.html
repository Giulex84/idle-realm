<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Pi SDK Baseline</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>
  <h1>Pi SDK Baseline</h1>

  <button onclick="login()">Login with Pi</button>
  <button onclick="pay()">Pay 1 Pi</button>

  <p id="status"></p>

  <script>
    Pi.init({ version: "2.0" });

    function login() {
      Pi.authenticate(["username"], (auth) => {
        document.getElementById("status").innerText =
          "Logged as " + auth.user.username;
      }, console.error);
    }

    async function pay() {
      try {
        const payment = await Pi.createPayment({
          amount: 1,
          memo: "Test payment"
        });

        await fetch("/api/pi", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            action: "approve",
            paymentId: payment.identifier
          })
        });

        document.getElementById("status").innerText = "Payment completed";
      } catch (e) {
        document.getElementById("status").innerText = "Payment failed";
        console.error(e);
      }
    }
  </script>
</body>
</html>
