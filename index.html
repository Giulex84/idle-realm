<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Idle Realm</title>

<style>
:root{
  --bg:#0b1220;
  --card:#141c33;
  --card2:#1b2546;
  --accent:#3b82f6;
  --danger:#ff4d6d;
  --text:#e6ecff;
  --muted:#9aa4c7;
}
*{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto}
body{
  margin:0;
  background:linear-gradient(180deg,#0a1020,#050a14);
  color:var(--text);
}
header{
  position:sticky;top:0;z-index:10;
  background:#060b18;
  display:flex;justify-content:space-around;
  padding:8px;font-size:14px;
}
main{max-width:520px;margin:auto;padding:16px}
.card{
  background:linear-gradient(180deg,var(--card),var(--card2));
  border-radius:18px;
  padding:16px;
  margin-bottom:16px;
}
h1,h2{margin:0 0 8px}
.small{font-size:13px;color:var(--muted)}
button{
  width:100%;
  border:none;
  border-radius:14px;
  padding:14px;
  margin-bottom:10px;
  font-size:16px;
  background:var(--accent);
  color:white;
}
button:disabled{opacity:.4}
.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}
.tile{
  height:72px;
  border-radius:14px;
  background:#0f1730;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:28px;
  cursor:pointer;
}
.tile.selected{outline:3px solid var(--danger)}
.danger{
  background:var(--danger);
}
.hidden{display:none}
</style>
</head>

<body>

<header>
  <span>ğŸ‘¥ <b id="pop"></b></span>
  <span>âš’ï¸ <b id="prod"></b></span>
  <span>ğŸ›¡ï¸ <b id="stab"></b>%</span>
  <span>â³ <b id="time"></b></span>
</header>

<main>
  <h1 id="title">Idle Realm</h1>
  <div class="small">A strategic realm shaped by irreversible choices</div>

  <div class="card">
    <h2>Decisions</h2>
    <button id="bSettle">ğŸ  Settle Families (âš’ï¸15)</button>
    <button id="bWork">âš’ï¸ Workshop (âš’ï¸20)</button>
    <button id="bCouncil">ğŸ›ï¸ Council (âš’ï¸30)</button>
    <button id="bMine">â›ï¸ Mine (âš’ï¸40)</button>
    <button id="bSmelt">ğŸ”¥ Smelter (âš’ï¸60 + â›ï¸10)</button>
    <div class="small" id="info"></div>
  </div>

  <div class="card">
    <h2>City</h2>
    <div class="grid" id="city"></div>
    <button id="bDismantle" class="danger">ğŸ§¹ Dismantle Selected District</button>
    <div class="small">Strategic rollback. No refunds.</div>
  </div>

  <div class="card">
    <h2>Era</h2>
    <b id="eraName"></b>
    <div class="small" id="eraDesc"></div>
  </div>

  <div class="card">
    <h2>Chronicle</h2>
    <div id="events" class="small"></div>
  </div>
</main>

<script>
const MAX_SLOTS=9;
const COST={
  settle:15,work:20,council:30,mine:40,smelt:60
};

const ERAS={
  foundations:{
    name:"Foundations",
    desc:"Growth and understanding.",
  },
  bronze:{
    name:"Age of Bronze",
    desc:"Industry and specialization emerge.",
  },
  iron:{
    name:"Iron Age",
    desc:"Heavy industry rises. External pressure looms.",
  }
};

const DEFAULT={
  era:"foundations",
  pop:12,
  prod:30,
  stab:100,
  time:0,
  ore:0,
  weapons:0,
  buildings:[],
  events:[]
};

let state=JSON.parse(localStorage.getItem("idleRealm")||"null")||structuredClone(DEFAULT);
if(!Array.isArray(state.buildings)) state.buildings=[];
let selected=null;

function save(){localStorage.setItem("idleRealm",JSON.stringify(state));}

function log(msg){
  state.events.unshift("â€¢ "+msg);
  state.events=state.events.slice(0,8);
}

function canBuild(cost){
  return state.prod>=cost && state.buildings.length<MAX_SLOTS;
}

function build(type){
  if(!canBuild(COST[type]))return;
  state.prod-=COST[type];
  if(type==="settle"){state.pop+=4;state.stab-=2;state.buildings.push("ğŸ ");}
  if(type==="work"){state.buildings.push("âš’ï¸");}
  if(type==="council"){state.stab+=10;state.buildings.push("ğŸ›ï¸");}
  if(type==="mine"){state.buildings.push("â›ï¸");}
  if(type==="smelt" && state.ore>=10){state.ore-=10;state.buildings.push("ğŸ”¥");}
  log(type+" built");
  update();
}

function dismantle(){
  if(selected===null)return;
  state.buildings.splice(selected,1);
  state.stab=Math.max(0,state.stab-5);
  selected=null;
  log("District dismantled");
  update();
}

function update(){
  pop.textContent=state.pop.toFixed(1);
  prod.textContent=state.prod.toFixed(0);
  stab.textContent=Math.max(0,Math.min(100,state.stab)).toFixed(0);
  time.textContent=state.time;

  eraName.textContent=ERAS[state.era].name;
  eraDesc.textContent=ERAS[state.era].desc;

  city.innerHTML="";
  for(let i=0;i<MAX_SLOTS;i++){
    const t=document.createElement("div");
    t.className="tile"+(i===selected?" selected":"");
    t.textContent=state.buildings[i]||"";
    t.onclick=()=>{selected=i;update();}
    city.appendChild(t);
  }

  events.innerHTML=state.events.map(e=>`<div>${e}</div>`).join("");
  save();
}

bSettle.onclick=()=>build("settle");
bWork.onclick=()=>build("work");
bCouncil.onclick=()=>build("council");
bMine.onclick=()=>build("mine");
bSmelt.onclick=()=>build("smelt");
bDismantle.onclick=dismantle;

setInterval(()=>{
  state.time++;
  const works=state.buildings.filter(b=>b==="âš’ï¸").length;
  const mines=state.buildings.filter(b=>b==="â›ï¸").length;
  const smelts=state.buildings.filter(b=>b==="ğŸ”¥").length;

  state.prod+=works*0.8;
  state.ore+=mines*0.4;
  state.weapons+=smelts*0.2;
  if(state.stab<100)state.stab+=0.05;

  if(state.era==="foundations" && state.buildings.length>=4){
    state.era="bronze";
    log("â˜… The Age of Bronze begins.");
  }
  if(state.era==="bronze" && state.weapons>=10){
    state.era="iron";
    log("â˜… The Iron Age dawns. Distant threats are rumored.");
  }

  update();
},1000);

update();

/* DEBUG RESET */
if(location.search.includes("debug=true")){
  title.ondblclick=()=>{
    localStorage.removeItem("idleRealm");
    location.reload();
  }
}
</script>

</body>
</html>
