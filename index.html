<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Idle Realm</title>

<style>
:root{
  --bg:#0b1220;
  --card:#141c33;
  --card2:#1b2546;
  --accent:#2f6bff;
  --bronze:#c27c2c;
  --text:#e6ecff;
  --muted:#9aa4c7;
  --ok:#22c55e;
}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto}
body{margin:0;background:linear-gradient(180deg,#0a1020,#050a14);color:var(--text)}
header{
  position:sticky;top:0;z-index:10;
  background:#060b18;
  padding:8px 12px;
  display:flex;flex-wrap:wrap;gap:8px;justify-content:space-between;
  font-size:14px;
}
main{padding:16px;max-width:500px;margin:auto}
.card{background:linear-gradient(180deg,var(--card),var(--card2));border-radius:16px;padding:16px;margin-bottom:16px}
button{width:100%;border:none;border-radius:14px;padding:14px;margin-bottom:10px;background:var(--accent);color:white;font-size:16px}
button:disabled{opacity:.4}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.tile{background:#0f1730;border-radius:12px;height:70px;display:flex;align-items:center;justify-content:center;font-size:28px}
.small{font-size:13px;color:var(--muted)}
.obj{font-size:14px;margin-bottom:4px}
.obj.ok{color:var(--ok)}
.notice{background:#0f1730;padding:10px;border-radius:12px;font-size:13px;margin-bottom:12px}
</style>
</head>

<body>

<header>
  <span>üë• <b id="pop"></b></span>
  <span>‚öíÔ∏è <b id="prod"></b></span>
  <span>ü•â <b id="bronze"></b></span>
  <span>üõ°Ô∏è <b id="stab"></b>%</span>
  <span>‚è≥ <b id="time"></b></span>
</header>

<main>
<h1>Idle Realm</h1>
<div class="small">A living world shaped by time and choices</div>

<div id="offlineNotice"></div>

<div class="card">
  <h2>Era</h2>
  <div><b>Bronze Age</b></div>
  <div class="small" style="margin-bottom:8px">
    Expansion slows. Infrastructure must adapt.
  </div>
  <div id="objectives"></div>
</div>

<div class="card">
  <h2>Build</h2>
  <button id="btnMine">‚õèÔ∏è Mine</button>
  <button id="btnSmelter">üî• Smelter</button>
  <div class="small" id="info"></div>
</div>

<div class="card">
  <h2>City</h2>
  <div class="grid" id="city"></div>
</div>

<div class="card">
  <h2>Events</h2>
  <div id="events"></div>
</div>
</main>

<script>
/* ===== CONFIG ===== */
const MAX_SLOTS = 9;
const COOLDOWN = 10;
const WORKSHOP_PROD = 0.12;
const BRONZE_RATE = 0.04;
const OFFLINE_CAP = 600;

const COST = {
  mine: 60,
  smelter: 80
};

const DEFAULT = {
  era: "bronze",
  pop: 24,
  prod: 80,
  bronze: 0,
  stab: 90,
  time: 0,
  lastAction: 0,
  lastSeen: Date.now(),
  buildings: ["‚öíÔ∏è","‚öíÔ∏è","üè†","üè†","üè†","üèõÔ∏è"],
  events: ["‚Ä¢ The realm restructures for the Bronze Age"]
};

let state = loadState();

/* ===== LOAD / SAVE ===== */
function loadState(){
  try{
    const s = JSON.parse(localStorage.getItem("idleRealm"));
    if(!s || s.era !== "bronze") return structuredClone(DEFAULT);
    return Object.assign(structuredClone(DEFAULT), s);
  }catch{
    return structuredClone(DEFAULT);
  }
}
function save(){
  state.lastSeen = Date.now();
  localStorage.setItem("idleRealm", JSON.stringify(state));
}
function log(msg){
  state.events.unshift("‚Ä¢ " + msg);
  state.events = state.events.slice(0,10);
}
function canAct(){
  return Date.now() - state.lastAction >= COOLDOWN*1000;
}

/* ===== OFFLINE ===== */
(function(){
  const elapsed = Math.floor((Date.now() - state.lastSeen)/1000);
  if(elapsed < 5) return;

  const workshops = state.buildings.filter(b=>b==="‚öíÔ∏è").length;
  const effective = Math.min(elapsed, OFFLINE_CAP);
  const gain = workshops * WORKSHOP_PROD * effective;

  state.prod += gain;

  offlineNotice.innerHTML = `
    <div class="notice">
      ‚è≥ While you were away:<br>
      +${gain.toFixed(1)} Production (${Math.floor(effective/60)} min)
    </div>
  `;
})();

/* ===== OBJECTIVES ===== */
function eraObjectives(){
  return [
    ["Build 1 Mine", state.buildings.includes("‚õèÔ∏è")],
    ["Build 1 Smelter", state.buildings.includes("üî•")],
    ["Produce 50 Bronze", state.bronze >= 50],
    ["Maintain Stability ‚â• 80%", state.stab >= 80]
  ];
}

/* ===== UPDATE ===== */
function update(){
  pop.innerText = state.pop.toFixed(0);
  prod.innerText = state.prod.toFixed(1);
  bronze.innerText = state.bronze.toFixed(1);
  stab.innerText = Math.max(0,Math.min(100,state.stab)).toFixed(0);
  time.innerText = state.time;

  objectives.innerHTML="";
  eraObjectives().forEach(o=>{
    const d=document.createElement("div");
    d.className="obj"+(o[1]?" ok":"");
    d.innerText=(o[1]?"‚úî ":"‚òê ")+o[0];
    objectives.appendChild(d);
  });

  const cd=Math.max(0,Math.ceil((COOLDOWN*1000-(Date.now()-state.lastAction))/1000));
  info.innerText = canAct() ? "Actions ready" : `Cooldown ${cd}s`;

  btnMine.disabled = !canAct() || state.prod < COST.mine || state.buildings.length>=MAX_SLOTS;
  btnSmelter.disabled = !canAct() || state.prod < COST.smelter || state.buildings.length>=MAX_SLOTS;

  city.innerHTML="";
  for(let i=0;i<MAX_SLOTS;i++){
    const t=document.createElement("div");
    t.className="tile";
    t.innerText = state.buildings[i] || "‚¨ú";
    city.appendChild(t);
  }

  events.innerHTML = state.events.map(e=>`<div>${e}</div>`).join("");
  save();
}

/* ===== ACTIONS ===== */
function build(type){
  if(!canAct()) return;

  if(type==="mine"){
    state.prod -= COST.mine;
    state.buildings.push("‚õèÔ∏è");
    log("Mine constructed");
  }
  if(type==="smelter"){
    state.prod -= COST.smelter;
    state.buildings.push("üî•");
    log("Smelter constructed");
  }
  state.lastAction = Date.now();
  update();
}

btnMine.onclick = ()=>build("mine");
btnSmelter.onclick = ()=>build("smelter");

/* ===== TICK ===== */
setInterval(()=>{
  state.time++;

  const workshops = state.buildings.filter(b=>b==="‚öíÔ∏è").length;
  const smelters = state.buildings.filter(b=>b==="üî•").length;

  state.prod += workshops * WORKSHOP_PROD;

  if(smelters>0 && state.prod>0 && state.stab>=80){
    const convert = Math.min(state.prod, smelters * BRONZE_RATE);
    state.prod -= convert;
    state.bronze += convert;
  }

  if(state.stab < 100) state.stab += 0.015;
  update();
},1000);

update();
</script>
</body>
</html>
