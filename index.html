<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pi SDK Baseline</title>

  <!-- Pi SDK -->
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>

  <script>
    let currentUser = null;

    document.addEventListener("DOMContentLoaded", () => {
      Pi.init({ version: "2.0" });
    });

    function login() {
      Pi.authenticate(
        ["username"],
        (auth) => {
          currentUser = auth.user;
          document.getElementById("user").innerText =
            "Welcome: " + currentUser.username;
        },
        (err) => {
          console.error("Login error", err);
        }
      );
    }

    function pay() {
      if (!currentUser) {
        alert("Login first");
        return;
      }

      Pi.createPayment(
        {
          amount: 1,
          memo: "Test payment",
          metadata: { purpose: "test" }
        },
        {
          onReadyForServerApproval: function (paymentId) {
            fetch("/api/pi", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                action: "approve",
                paymentId
              })
            });
          },

          onReadyForServerCompletion: function (paymentId, txid) {
            fetch("/api/pi", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                action: "complete",
                paymentId,
                txid
              })
            });
          },

          onCancel: function (paymentId) {
            console.log("Payment cancelled", paymentId);
          },

          onError: function (error, payment) {
            console.error("Payment error", error, payment);
          }
        }
      );
    }
  </script>
</head>

<body>
  <h1>Pi SDK Baseline</h1>

  <button onclick="login()">Login with Pi</button>
  <button onclick="pay()">Pay 1 Pi</button>

  <p id="user"></p>
</body>
</html>
