<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Idle Realm</title>

<style>
body{
  margin:0;
  background:#0b1220;
  color:#e6ecff;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
}
header{
  position:sticky;
  top:0;
  background:#060b18;
  padding:8px 12px;
  display:flex;
  justify-content:space-between;
  font-size:14px;
}
main{padding:16px;max-width:500px;margin:auto}
.card{
  background:#141c33;
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}
button{
  width:100%;
  border:none;
  border-radius:14px;
  padding:14px;
  margin-bottom:10px;
  background:#2f6bff;
  color:white;
  font-size:16px;
}
button:disabled{opacity:.4}
.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}
.tile{
  background:#0f1730;
  border-radius:12px;
  height:70px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:28px;
}
.small{font-size:13px;color:#9aa4c7}
</style>
</head>

<body>

<header>
  <span>ğŸ‘¥ <b id="pop"></b></span>
  <span>âš’ï¸ <b id="prod"></b></span>
  <span>ğŸŸ  <b id="bronze"></b></span>
  <span>ğŸ›¡ï¸ <b id="stab"></b>%</span>
</header>

<main>
  <h1>Idle Realm</h1>

  <div class="card">
    <h2>Era â€” Bronze Age</h2>
    <div class="small">Expansion slows. Infrastructure must adapt.</div>
    <div id="goals"></div>
  </div>

  <div class="card">
    <h2>Build</h2>
    <button id="btnSettlement">ğŸ  Settlement (40)</button>
    <button id="btnWorkshop">âš’ï¸ Workshop (60)</button>
    <button id="btnCouncil">ğŸ›ï¸ Council (80)</button>
    <button id="btnMine">â›ï¸ Mine (70)</button>
    <button id="btnSmelter">ğŸ”¥ Smelter (90)</button>
  </div>

  <div class="card">
    <h2>City</h2>
    <div class="grid" id="city"></div>
  </div>

  <div class="card">
    <h2>Advisor</h2>
    <div class="small" id="advisor"></div>
  </div>

  <div class="card">
    <h2>Events</h2>
    <div id="events"></div>
  </div>
</main>

<script>
/* ===== SAFE STATE ===== */

const DEFAULT = {
  pop: 24,
  prod: 0,
  bronze: 0,
  stab: 85,
  buildings: [],
  events: []
};

function safe(n, fallback=0){
  n = Number(n);
  return Number.isFinite(n) ? n : fallback;
}

function load(){
  let s;
  try{ s = JSON.parse(localStorage.getItem("idleRealm")); }
  catch{ s = {}; }

  return {
    pop: safe(s.pop, DEFAULT.pop),
    prod: safe(s.prod),
    bronze: safe(s.bronze),
    stab: Math.min(100, Math.max(0, safe(s.stab, DEFAULT.stab))),
    buildings: Array.isArray(s.buildings) ? s.buildings : [],
    events: Array.isArray(s.events) ? s.events : []
  };
}

let state = load();

function save(){
  localStorage.setItem("idleRealm", JSON.stringify(state));
}

function log(msg){
  state.events.unshift("â€¢ " + msg);
  state.events = state.events.slice(0,8);
}

function count(b){
  return state.buildings.filter(x=>x===b).length;
}

/* ===== UPDATE UI ===== */

function update(){
  pop.textContent = state.pop.toFixed(0);
  prod.textContent = state.prod.toFixed(1);
  bronze.textContent = state.bronze.toFixed(1);
  stab.textContent = state.stab.toFixed(0);

  city.innerHTML="";
  for(let i=0;i<9;i++){
    const t=document.createElement("div");
    t.className="tile";
    t.textContent=state.buildings[i]||"â¬œ";
    city.appendChild(t);
  }

  goals.innerHTML = `
    ${count("â›ï¸")>=1?"âœ…":"â¬œ"} Build 1 Mine<br>
    ${count("ğŸ”¥")>=1?"âœ…":"â¬œ"} Build 1 Smelter<br>
    ${state.bronze>=50?"âœ…":"â¬œ"} Produce 50 Bronze<br>
    ${state.stab>=80?"âœ…":"â¬œ"} Maintain Stability â‰¥ 80%
  `;

  advisor.textContent =
    state.stab<80 ? "Stability is low. Consider governance." :
    state.bronze<50 ? "Bronze production is slow. Balance mines and smelters." :
    "The realm is stable. Prepare for future threats.";

  events.innerHTML = state.events.map(e=>`<div>${e}</div>`).join("");

  save();
}

/* ===== BUILD ===== */

function build(type,cost,icon){
  if(state.prod < cost) return;
  state.prod -= cost;
  state.buildings.push(icon);
  log(type+" constructed");
  update();
}

btnSettlement.onclick=()=>build("Settlement",40,"ğŸ ");
btnWorkshop.onclick=()=>build("Workshop",60,"âš’ï¸");
btnCouncil.onclick=()=>build("Council",80,"ğŸ›ï¸");
btnMine.onclick=()=>build("Mine",70,"â›ï¸");
btnSmelter.onclick=()=>build("Smelter",90,"ğŸ”¥");

/* ===== TICK ===== */

setInterval(()=>{
  const workshops = count("âš’ï¸");
  const mines = count("â›ï¸");
  const smelters = count("ğŸ”¥");
  const councils = count("ğŸ›ï¸");

  const prodGain = workshops * 0.4;
  const oreGain = mines * 0.5;
  const bronzeGain = Math.min(oreGain, smelters * 0.3);

  state.prod += prodGain;
  state.bronze += bronzeGain;

  if(state.stab < 100){
    state.stab += councils * 0.05;
  }

  update();
},1000);

update();
</script>
</body>
</html>
