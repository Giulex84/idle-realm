<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Idle Realm</title>

<style>
:root{
  --card:#141c33;
  --card2:#1b2546;
  --accent:#2f6bff;
  --bronze:#c27c2c;
  --iron:#9aa0a6;
  --text:#e6ecff;
  --muted:#9aa4c7;
  --ok:#22c55e;
}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto}
body{margin:0;background:linear-gradient(180deg,#0a1020,#050a14);color:var(--text)}
header{
  position:sticky;top:0;z-index:10;
  background:#060b18;
  padding:8px 12px;
  display:flex;flex-wrap:wrap;gap:8px;justify-content:space-between;
  font-size:14px;
}
main{padding:16px;max-width:500px;margin:auto}
.card{background:linear-gradient(180deg,var(--card),var(--card2));border-radius:16px;padding:16px;margin-bottom:16px}
button{width:100%;border:none;border-radius:14px;padding:14px;margin-bottom:10px;background:var(--accent);color:white;font-size:16px}
button.iron{background:linear-gradient(180deg,#cfd4da,#7b8188);color:#0b0f14;font-weight:600}
button:disabled{opacity:.4}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.tile{background:#0f1730;border-radius:12px;height:70px;display:flex;align-items:center;justify-content:center;font-size:26px}
.small{font-size:13px;color:var(--muted)}
.obj{font-size:14px;margin-bottom:4px}
.obj.ok{color:var(--ok)}
.advisor{font-size:12px;color:#aab3ff;margin-top:10px;text-align:center}
.bar{height:8px;background:#0b1228;border-radius:6px;overflow:hidden;margin-top:6px}
.bar>div{height:100%;background:var(--ok);width:0%;transition:width .3s}
</style>
</head>

<body>

<header>
  <span>ğŸ‘¥ <b id="pop"></b></span>
  <span>âš’ï¸ <b id="prod"></b></span>
  <span>ğŸ¥‰ <b id="bronze"></b></span>
  <span>ğŸ›¡ï¸ <b id="stab"></b>%</span>
  <span>â³ <b id="time"></b></span>
</header>

<main>
<h1>Idle Realm</h1>
<div class="small">A living world shaped by time and choices</div>

<div class="card">
  <h2>Era</h2>
  <div id="eraTitle"></div>
  <div id="eraDesc" class="small"></div>
  <div id="objectives"></div>

  <div id="sustainBox">
    <div class="small">Stability sustained</div>
    <div class="bar"><div id="sustainBar"></div></div>
  </div>

  <button id="advanceEra" class="iron" style="display:none">
    âš”ï¸ Enter the Iron Age (75 ğŸ¥‰)
  </button>
</div>

<div class="card">
  <h2>Build</h2>
  <button id="btnSettle">ğŸ  Settlement</button>
  <button id="btnWork">âš’ï¸ Workshop</button>
  <button id="btnCouncil">ğŸ›ï¸ Council</button>
  <button id="btnCouncil2">ğŸ›ï¸ Council II</button>
  <button id="btnMine">â›ï¸ Mine</button>
  <div class="small" id="info"></div>
</div>

<div class="card">
  <h2>City</h2>
  <div class="grid" id="city"></div>
</div>

<div class="card">
  <h2>Events</h2>
  <div id="events"></div>
  <div class="advisor" id="advisor"></div>
</div>
</main>

<script>
/* ===== CONFIG ===== */
const SLOT_BY_ERA={bronze:12};
const ERA3_COST=75;
const COOLDOWN=8;

const COST={settlement:15,workshop:20,council:30,mine:25};

const DEFAULT={
  v:11,
  era:"bronze",
  pop:12,
  prod:30,
  bronze:0,
  stab:100,
  time:0,
  lastAction:0,
  lastSeen:Date.now(),
  buildings:["âš’ï¸"],
  councilLv:0,
  sustain:0,
  events:["â€¢ Bronze Age begins"]
};

let state=load();

/* ===== HELPERS ===== */
const $=id=>document.getElementById(id);
const maxSlots=()=>SLOT_BY_ERA[state.era];
const clamp=()=>state.stab=Math.max(0,Math.min(100,state.stab));

/* ===== LOAD / SAVE ===== */
function load(){
  try{
    const s=JSON.parse(localStorage.getItem("idleRealm"));
    if(!s||s.v!==DEFAULT.v) throw 0;
    return Object.assign(structuredClone(DEFAULT),s);
  }catch{
    localStorage.removeItem("idleRealm");
    return structuredClone(DEFAULT);
  }
}
const save=()=>localStorage.setItem("idleRealm",JSON.stringify(state));
const canAct=()=>Date.now()-state.lastAction>=COOLDOWN*1000;
const log=m=>(state.events.unshift("â€¢ "+m),state.events=state.events.slice(0,10));

/* ===== UPDATE ===== */
function update(){
  pop.textContent=state.pop;
  prod.textContent=state.prod.toFixed(1);
  bronze.textContent=state.bronze.toFixed(1);
  stab.textContent=Math.round(state.stab);
  time.textContent=state.time;

  eraTitle.innerHTML="<b>Bronze Age</b>";
  eraDesc.textContent="Governance stabilizes growing societies.";

  objectives.innerHTML=`
    <div class="obj ${state.sustain>=300?"ok":""}">âœ” Stability â‰¥ 75% (sustained)</div>
    <div class="obj ${state.bronze>=75?"ok":""}">âœ” Bronze â‰¥ 75</div>
    <div class="obj ${state.councilLv===2?"ok":""}">âœ” Council II established</div>
  `;

  sustainBar.style.width=Math.min(100,state.sustain/300*100)+"%";

  advanceEra.style.display=
    state.sustain>=300&&state.bronze>=75&&state.councilLv===2?"block":"none";

  info.textContent=
    "ğŸ  15 âš’ï¸ | âš’ï¸ 20 âš’ï¸ | ğŸ›ï¸ 30 âš’ï¸ | â›ï¸ 25 âš’ï¸ | ğŸ›ï¸ II 30 ğŸ¥‰";

  city.innerHTML="";
  for(let i=0;i<maxSlots();i++){
    const t=document.createElement("div");
    t.className="tile";
    t.textContent=state.buildings[i]||"â¬œ";
    t.onclick=()=>remove(i);
    city.appendChild(t);
  }

  advisor.textContent=
    state.councilLv===2?"The state asserts its authority.":"Governance is fragile.";

  events.innerHTML=state.events.map(e=>`<div>${e}</div>`).join("");
  save();
}

/* ===== ACTIONS ===== */
const act=()=>state.lastAction=Date.now();
function build(type,icon){
  if(!canAct()||state.prod<COST[type]||state.buildings.length>=maxSlots()) return;
  if(type==="council"&&state.councilLv>0) return;
  state.prod-=COST[type];
  state.buildings.push(icon);
  if(type==="settlement") state.pop+=4;
  if(type==="council") state.councilLv=1;
  log(icon+" constructed");act();update();
}
const remove=i=>{
  const b=state.buildings[i];
  if(!b) return;
  state.buildings.splice(i,1);
  log(b+" removed");act();update();
};

/* ===== BUTTONS ===== */
btnSettle.onclick=()=>build("settlement","ğŸ ");
btnWork.onclick=()=>build("workshop","âš’ï¸");
btnCouncil.onclick=()=>build("council","ğŸ›ï¸");
btnMine.onclick=()=>build("mine","â›ï¸");
btnCouncil2.onclick=()=>{
  if(!canAct()||state.councilLv!==1||state.bronze<30) return;
  state.bronze-=30;state.councilLv=2;
  log("Council II established");act();update();
};
advanceEra.onclick=()=>{
  if(state.bronze<ERA3_COST) return;
  state.bronze-=ERA3_COST;state.era="iron";
  log("The Iron Age begins");act();update();
};

/* ===== TICK ===== */
setInterval(()=>{
  state.time++;

  const w=state.buildings.filter(b=>b==="âš’ï¸").length;
  const m=state.buildings.filter(b=>b==="â›ï¸").length;

  state.prod+=w*0.22;
  state.bronze+=m*0.05;

  /* pressure */
  let loss=w*0.04+m*0.05;
  if(state.councilLv===2) loss*=0.6;
  state.stab-=loss;

  /* recovery */
  let rec=0;
  if(state.pop>=20) rec=0.02;
  if(state.pop>=30) rec=0.05;
  if(state.councilLv===1) rec*=1.3;
  if(state.councilLv===2) rec*=1.8;

  state.stab+=rec;

  if(state.stab>=75) state.sustain++; else state.sustain=0;
  clamp();update();
},1000);

update();
</script>
</body>
</html>
