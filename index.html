<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Idle Realm</title>

<style>
:root{
  --bg:#0b1220;
  --card:#141c33;
  --card2:#1b2546;
  --accent:#2f6bff;
  --bronze:#c27c2c;
  --text:#e6ecff;
  --muted:#9aa4c7;
  --ok:#22c55e;
}

*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto}

body{
  margin:0;
  background:linear-gradient(180deg,#0a1020,#050a14);
  color:var(--text);
}

header{
  position:sticky;
  top:0;
  background:#060b18;
  padding:8px 12px;
  display:flex;
  flex-wrap:wrap;
  justify-content:space-between;
  gap:8px;
  font-size:14px;
  z-index:10;
}

main{padding:16px;max-width:500px;margin:auto}

.card{
  background:linear-gradient(180deg,var(--card),var(--card2));
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}

button{
  width:100%;
  border:none;
  border-radius:14px;
  padding:14px;
  margin-bottom:10px;
  background:var(--accent);
  color:white;
  font-size:16px;
}

button.bronze{
  background:linear-gradient(180deg,#e0a24c,#b87328);
  color:#1a0f00;
  font-weight:600;
}

button:disabled{opacity:.4}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}

.tile{
  background:#0f1730;
  border-radius:12px;
  height:70px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:28px;
}

.small{font-size:13px;color:var(--muted)}
.obj{font-size:14px;margin-bottom:4px}
.obj.ok{color:var(--ok)}
.locked{opacity:.5}
</style>
</head>

<body>

<header>
  <span>üë• <b id="pop"></b></span>
  <span>‚öíÔ∏è <b id="prod"></b></span>
  <span>ü•â <b id="bronze"></b></span>
  <span>üõ°Ô∏è <b id="stab"></b>%</span>
  <span>‚è≥ <b id="time"></b></span>
</header>

<main>
  <h1>Idle Realm</h1>
  <div class="small">A living world shaped by time and choices</div>

  <div class="card">
    <h2>Era</h2>
    <div id="eraTitle"></div>
    <div id="eraDesc" class="small" style="margin-bottom:8px"></div>
    <div id="objectives"></div>
    <button id="advanceEra" class="bronze" style="display:none">
      ü•â Enter the Bronze Age
    </button>
  </div>

  <div class="card">
    <h2>Build</h2>
    <button id="btnSettle">üè† Settlement</button>
    <button id="btnWork">‚öíÔ∏è Workshop</button>
    <button id="btnCouncil">üèõÔ∏è Council</button>
    <div class="small" id="info"></div>
  </div>

  <div class="card">
    <h2>City</h2>
    <div class="grid" id="city"></div>
  </div>

  <div class="card">
    <h2>Events</h2>
    <div id="events"></div>
  </div>
</main>

<script>
/* ===== CONFIG ===== */
const MAX_SLOTS = 9;
const COOLDOWN = 8;

const COST = {
  settlement: 15,
  workshop: 20,
  council: 30
};

const DEFAULT = {
  era: "foundations",
  pop: 12,
  prod: 30,
  bronze: 0,
  stab: 100,
  time: 0,
  lastAction: 0,
  buildings: ["‚öíÔ∏è"],
  events: ["‚Ä¢ Realm founded with basic craftsmanship"]
};

function loadState(){
  let s;
  try{ s = JSON.parse(localStorage.getItem("idleRealm")); }
  catch{ return structuredClone(DEFAULT); }

  if(!s || typeof s !== "object") return structuredClone(DEFAULT);
  for(const k in DEFAULT){
    if(typeof s[k] !== typeof DEFAULT[k]) s[k] = DEFAULT[k];
  }
  if(!Array.isArray(s.buildings)) s.buildings = ["‚öíÔ∏è"];
  if(!Array.isArray(s.events)) s.events = [];
  return s;
}

let state = loadState();

function save(){
  localStorage.setItem("idleRealm", JSON.stringify(state));
}

function log(msg){
  state.events.unshift("‚Ä¢ " + msg);
  state.events = state.events.slice(0,10);
}

function canAct(){
  return Date.now() - state.lastAction >= COOLDOWN * 1000;
}

/* ===== ERA LOGIC ===== */
function eraObjectives(){
  if(state.era==="foundations"){
    return [
      ["Build 3 Settlements", state.buildings.filter(b=>b==="üè†").length>=3],
      ["Reach 50 Production", state.prod>=50],
      ["Establish the Council", state.buildings.includes("üèõÔ∏è")],
      ["Stability ‚â• 70%", state.stab>=70]
    ];
  }
  return [];
}

function foundationsComplete(){
  return eraObjectives().every(o=>o[1]);
}

/* ===== UPDATE ===== */
function update(){
  pop.innerText = state.pop.toFixed(1);
  prod.innerText = state.prod.toFixed(1);
  bronze.innerText = state.bronze.toFixed(1);
  stab.innerText = Math.max(0,Math.min(100,state.stab)).toFixed(0);
  time.innerText = state.time;

  eraTitle.innerHTML =
    state.era==="foundations"
    ? "<b>Foundations</b>"
    : "<b>Bronze Age</b>";

  eraDesc.innerText =
    state.era==="foundations"
    ? "Fast growth to understand the game."
    : "Resources are refined. Preparation begins.";

  objectives.innerHTML="";
  if(state.era==="foundations"){
    eraObjectives().forEach(o=>{
      const d=document.createElement("div");
      d.className="obj"+(o[1]?" ok":"");
      d.innerText=(o[1]?"‚úî ":"‚òê ")+o[0];
      objectives.appendChild(d);
    });
  }else{
    objectives.innerHTML = `
      <div class="obj">‚úî Bronze production ongoing</div>
      <div class="obj locked">‚òê Iron Age (Approaching)</div>
      <div class="small">Something is coming. It may be war. It may be famine.</div>
    `;
  }

  advanceEra.style.display =
    state.era==="foundations" && foundationsComplete()
    ? "block"
    : "none";

  const cd = Math.max(0,
    Math.ceil((COOLDOWN*1000 - (Date.now()-state.lastAction))/1000)
  );

  info.innerText =
    `Settlement ${COST.settlement} | Workshop ${COST.workshop} | Council ${COST.council}` +
    (canAct() ? " ‚Ä¢ Ready" : ` ‚Ä¢ Cooldown ${cd}s`);

  btnSettle.disabled =
    !canAct() || state.prod < COST.settlement || state.buildings.length >= MAX_SLOTS;

  btnWork.disabled =
    !canAct() || state.prod < COST.workshop || state.buildings.length >= MAX_SLOTS;

  btnCouncil.disabled =
    !canAct() || state.prod < COST.council || state.buildings.includes("üèõÔ∏è");

  city.innerHTML="";
  for(let i=0;i<MAX_SLOTS;i++){
    const t=document.createElement("div");
    t.className="tile";
    t.innerText = state.buildings[i] || "‚¨ú";
    city.appendChild(t);
  }

  events.innerHTML = state.events.map(e=>`<div>${e}</div>`).join("");
  save();
}

/* ===== ACTIONS ===== */
function build(type){
  if(!canAct()) return;

  if(type==="settlement"){
    state.prod -= COST.settlement;
    state.pop += 4;
    state.stab -= 6;
    state.buildings.push("üè†");
    log("Settlement built");
  }

  if(type==="workshop"){
    state.prod -= COST.workshop;
    state.buildings.push("‚öíÔ∏è");
    log("Workshop built");
  }

  if(type==="council"){
    state.prod -= COST.council;
    state.stab += 15;
    state.buildings.push("üèõÔ∏è");
    log("Council established");
  }

  state.lastAction = Date.now();
  update();
}

btnSettle.onclick = () => build("settlement");
btnWork.onclick   = () => build("workshop");
btnCouncil.onclick= () => build("council");

advanceEra.onclick = ()=>{
  state.era="bronze";
  log("The Bronze Age begins");
  update();
};

/* ===== TICK ===== */
setInterval(()=>{
  state.time++;

  const workshops = state.buildings.filter(b=>b==="‚öíÔ∏è").length;
  state.prod += workshops * 0.8;

  if(state.era==="bronze"){
    state.bronze += workshops * 0.15;
  }

  if(state.stab < 100) state.stab += 0.1;
  update();
},1000);

update();
</script>
</body>
</html>
