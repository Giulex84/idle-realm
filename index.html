<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Idle Realm</title>

<style>
:root{
  --bg:#0b1220;
  --card:#141c33;
  --card2:#1b2546;
  --accent:#2f6bff;
  --bronze:#c27c2c;
  --text:#e6ecff;
  --muted:#9aa4c7;
  --ok:#22c55e;
  --bad:#ef4444;
}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto}
body{margin:0;background:linear-gradient(180deg,#0a1020,#050a14);color:var(--text)}
header{
  position:sticky;top:0;z-index:10;
  background:#060b18;
  padding:8px 12px;
  display:flex;flex-wrap:wrap;gap:8px;justify-content:space-between;
  font-size:14px;
}
main{padding:16px;max-width:500px;margin:auto}
.card{background:linear-gradient(180deg,var(--card),var(--card2));border-radius:16px;padding:16px;margin-bottom:16px}
button{width:100%;border:none;border-radius:14px;padding:14px;margin-bottom:10px;background:var(--accent);color:white;font-size:16px}
button.bronze{background:linear-gradient(180deg,#e0a24c,#b87328);color:#1a0f00;font-weight:600}
button:disabled{opacity:.4}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.tile{background:#0f1730;border-radius:12px;height:70px;display:flex;align-items:center;justify-content:center;font-size:28px}
.small{font-size:13px;color:var(--muted)}
.obj{font-size:14px;margin-bottom:4px}
.obj.ok{color:var(--ok)}
.notice{background:#0f1730;padding:10px;border-radius:12px;font-size:13px;margin-bottom:12px}
</style>
</head>

<body>

<header>
  <span>üë• <b id="pop"></b></span>
  <span>‚öíÔ∏è <b id="prod"></b></span>
  <span>ü•â <b id="bronze"></b></span>
  <span>üõ°Ô∏è <b id="stab"></b>%</span>
  <span>‚è≥ <b id="time"></b></span>
</header>

<main>
<h1>Idle Realm</h1>
<div class="small">A living world shaped by time and choices</div>

<div id="offlineNotice"></div>

<div class="card">
  <h2>Era</h2>
  <div id="eraTitle"></div>
  <div id="eraDesc" class="small" style="margin-bottom:8px"></div>
  <div id="objectives"></div>
  <button id="advanceEra" class="bronze" style="display:none">
    ü•â Enter the Bronze Age (50 ‚öíÔ∏è)
  </button>
</div>

<div class="card">
  <h2>Build</h2>
  <button id="btnSettle">üè† Settlement</button>
  <button id="btnWork">‚öíÔ∏è Workshop</button>
  <button id="btnCouncil">üèõÔ∏è Council</button>
  <div class="small" id="info"></div>
</div>

<div class="card">
  <h2>City</h2>
  <div class="grid" id="city"></div>
</div>

<div class="card">
  <h2>Events</h2>
  <div id="events"></div>
</div>
</main>

<script>
/* ===== CONFIG ===== */
const MAX_SLOTS=9;
const COOLDOWN=8;
const BASE_OFFLINE_CAP_FOUNDATIONS=300;
const BASE_OFFLINE_CAP_BRONZE=600;
const COUNCIL_OFFLINE_BONUS=300;
const ERA2_COST = 50;

const COST={settlement:15,workshop:20,council:30};

const DEFAULT={
  era:"foundations",
  pop:12,
  prod:30,
  bronze:0,
  stab:100,
  time:0,
  lastAction:0,
  lastSeen:Date.now(),
  buildings:["‚öíÔ∏è"],
  events:["‚Ä¢ Realm founded with basic craftsmanship"]
};

let state=loadState();

/* ===== LOAD / SAVE ===== */
function loadState(){
  try{
    const s=JSON.parse(localStorage.getItem("idleRealm"));
    if(!s) return structuredClone(DEFAULT);
    return Object.assign(structuredClone(DEFAULT),s);
  }catch{return structuredClone(DEFAULT)}
}
function save(){
  state.lastSeen=Date.now();
  localStorage.setItem("idleRealm",JSON.stringify(state));
}
function log(msg){
  state.events.unshift("‚Ä¢ "+msg);
  state.events=state.events.slice(0,10);
}
function canAct(){
  return Date.now()-state.lastAction>=COOLDOWN*1000;
}

/* ===== OFFLINE ===== */
(function(){
  const now=Date.now();
  const elapsed=Math.floor((now-state.lastSeen)/1000);
  if(elapsed<5) return;

  const workshops=state.buildings.filter(b=>b==="‚öíÔ∏è").length;
  const hasCouncil=state.buildings.includes("üèõÔ∏è");

  let cap=state.era==="foundations"
    ? BASE_OFFLINE_CAP_FOUNDATIONS
    : BASE_OFFLINE_CAP_BRONZE+(hasCouncil?COUNCIL_OFFLINE_BONUS:0);

  const effective=Math.min(elapsed,cap);
  const prodGain=workshops*0.25*effective;
  state.prod+=prodGain;

  offlineNotice.innerHTML=`
    <div class="notice">
      ‚è≥ While you were away:<br>
      +${prodGain.toFixed(1)} Production (${Math.floor(effective/60)} min)
      ${elapsed>cap?"<br>‚ö†Ô∏è Production reached its limit.":""}
    </div>`;
})();

/* ===== ERA ===== */
function eraObjectives(){
  return [
    ["Build 3 Settlements",state.buildings.filter(b=>b==="üè†").length>=3],
    ["Reach 50 Production",state.prod>=50],
    ["Establish the Council",state.buildings.includes("üèõÔ∏è")],
    ["Stability ‚â• 70%",state.stab>=70]
  ];
}
function foundationsComplete(){
  return eraObjectives().every(o=>o[1]);
}

/* ===== UPDATE ===== */
function update(){
  pop.innerText=state.pop.toFixed(1);
  prod.innerText=state.prod.toFixed(1);
  bronze.innerText=state.bronze.toFixed(1);
  stab.innerText=Math.max(0,Math.min(100,state.stab)).toFixed(0);
  time.innerText=state.time;

  eraTitle.innerHTML=state.era==="foundations"?"<b>Foundations</b>":"<b>Bronze Age</b>";
  eraDesc.innerText=state.era==="foundations"
    ?"Fast growth to understand the game."
    :"Preparation replaces expansion. Stability matters.";

  objectives.innerHTML="";
  eraObjectives().forEach(o=>{
    const d=document.createElement("div");
    d.className="obj"+(o[1]?" ok":"");
    d.innerText=(o[1]?"‚úî ":"‚òê ")+o[0];
    objectives.appendChild(d);
  });

  advanceEra.style.display =
    state.era==="foundations" && foundationsComplete() ? "block" : "none";

  advanceEra.disabled = state.prod < ERA2_COST;

  const cd=Math.max(0,Math.ceil((COOLDOWN*1000-(Date.now()-state.lastAction))/1000));
  info.innerText=`Settlement ${COST.settlement} | Workshop ${COST.workshop} | Council ${COST.council}`+(canAct()?" ‚Ä¢ Ready":` ‚Ä¢ Cooldown ${cd}s`);

  btnSettle.disabled=!canAct()||state.prod<COST.settlement||state.buildings.length>=MAX_SLOTS;
  btnWork.disabled=!canAct()||state.prod<COST.workshop||state.buildings.length>=MAX_SLOTS;
  btnCouncil.disabled=!canAct()||state.prod<COST.council||state.buildings.includes("üèõÔ∏è");

  city.innerHTML="";
  for(let i=0;i<MAX_SLOTS;i++){
    const t=document.createElement("div");
    t.className="tile";
    t.innerText=state.buildings[i]||"‚¨ú";
    city.appendChild(t);
  }

  events.innerHTML=state.events.map(e=>`<div>${e}</div>`).join("");
  save();
}

/* ===== ACTIONS ===== */
function build(type){
  if(!canAct()) return;
  if(type==="settlement"){state.prod-=COST.settlement;state.pop+=4;state.stab-=6;state.buildings.push("üè†");log("Settlement built")}
  if(type==="workshop"){state.prod-=COST.workshop;state.buildings.push("‚öíÔ∏è");log("Workshop built")}
  if(type==="council"){state.prod-=COST.council;state.stab+=15;state.buildings.push("üèõÔ∏è");log("Council established")}
  state.lastAction=Date.now();
  update();
}

btnSettle.onclick=()=>build("settlement");
btnWork.onclick=()=>build("workshop");
btnCouncil.onclick=()=>build("council");

advanceEra.onclick=()=>{
  if(state.prod < ERA2_COST) return;
  state.prod -= ERA2_COST;
  state.era="bronze";
  log("The Bronze Age begins");
  update();
};

/* ===== TICK ===== */
setInterval(()=>{
  state.time++;
  const workshops=state.buildings.filter(b=>b==="‚öíÔ∏è").length;
  const hasCouncil=state.buildings.includes("üèõÔ∏è");

  state.prod+=workshops*0.25;

  if(state.era==="bronze"&&state.stab>=80){
    state.bronze+=workshops*0.05;
  }

  if(state.era==="bronze"){
    let upkeep=workshops*0.05;
    if(hasCouncil) upkeep*=0.5;
    state.stab-=upkeep;
  }

  if(state.stab<100) state.stab+=0.02;
  update();
},1000);

update();
</script>
</body>
</html>
