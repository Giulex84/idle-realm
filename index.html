<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Idle Realm</title>

<!-- PI SDK ‚Äì NON TOCCARE -->
<script src="https://sdk.minepi.com/pi-sdk.js"></script>
<script>
  Pi.init({ version: "2.0" });
</script>

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system;
  background: radial-gradient(circle at top, #0f172a, #020617);
  color: #e5e7eb;
}

header {
  padding: 20px;
  border-bottom: 1px solid #1f2937;
}

main {
  padding: 16px;
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
}

@media (min-width: 900px) {
  main { grid-template-columns: 1fr 1fr; }
}

.panel {
  background: rgba(17,24,39,0.95);
  border: 1px solid #1f2937;
  border-radius: 14px;
  padding: 16px;
}

.stat {
  display: flex;
  justify-content: space-between;
  margin-bottom: 6px;
}

.stat span:last-child {
  font-weight: 600;
}

button {
  background: #2563eb;
  border: none;
  color: white;
  padding: 8px 12px;
  border-radius: 8px;
  margin: 4px 4px 0 0;
}

button.selected {
  background: #4f46e5;
}

.map {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px;
}

.tile {
  height: 54px;
  border-radius: 10px;
  border: 1px solid #1f2937;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  background: #020617;
}

.tile.empty { cursor: pointer; }
.tile.settlement { background: #1e293b; }
.tile.workshop { background: #1f2937; }
.tile.council { background: #312e81; }

.event {
  background: #020617;
  border: 1px solid #1f2937;
  border-radius: 10px;
  padding: 10px;
  margin-bottom: 8px;
}
</style>
</head>

<body>
<header>
  <h1>Idle Realm</h1>
  <p>A living world shaped by time and eras</p>
</header>

<main>
  <div class="panel">
    <h2>Realm</h2>
    <div class="stat"><span>Era</span><span id="eraValue"></span></div>
    <div class="stat"><span>Population</span><span id="popValue"></span></div>
    <div class="stat"><span>Production</span><span id="prodValue"></span></div>
    <div class="stat"><span>Stability</span><span id="stabValue"></span></div>

    <h3>Build</h3>
    <button id="b-settlement" onclick="selectBuild('settlement')">üè† Settlement</button>
    <button id="b-workshop" onclick="selectBuild('workshop')">‚öí Workshop</button>
    <button id="b-council" onclick="selectBuild('council')">üèõ Council</button>
  </div>

  <div class="panel">
    <h2>World Map</h2>
    <div class="map" id="map"></div>
  </div>

  <div class="panel">
    <h2>Events</h2>
    <div id="events"></div>
  </div>

  <div class="panel">
    <h2>Meta</h2>
    <div class="stat"><span>Play time</span><span id="playValue"></span></div>
    <div class="stat"><span>Ticks</span><span id="tickValue"></span></div>
    <button onclick="resetGame()">Reset World</button>
  </div>
</main>

<script>
var KEY = "idle_realm_save";

var ERAS = [
  { name: "Foundations", pop: 0.01, prod: 1.0, decay: 0.004 },
  { name: "Expansion", pop: 0.015, prod: 1.2, decay: 0.006 },
  { name: "Crisis", pop: 0.005, prod: 0.9, decay: 0.01 }
];

function defaultState() {
  return {
    era: 0,
    pop: 10,
    prod: 20,
    stab: 70,
    map: Array(49).fill(null),
    buildings: { settlement: 1, workshop: 0, council: 0 },
    last: Date.now(),
    ticks: 0,
    play: 0
  };
}

var saved = localStorage.getItem(KEY);
var state = saved ? JSON.parse(saved) : defaultState();
var selected = null;

function save() {
  localStorage.setItem(KEY, JSON.stringify(state));
}

function loop() {
  var now = Date.now();
  var sec = Math.min((now - state.last) / 1000, 86400);
  if (sec <= 0) return;

  var era = ERAS[state.era];

  state.prod += state.pop * 0.1 * era.prod * sec;
  if (state.stab > 40) state.pop += era.pop * sec;
  state.stab -= era.decay * sec;

  state.stab = Math.max(0, Math.min(100, state.stab));
  if (state.pop > 80) state.era = 2;
  else if (state.pop > 30) state.era = 1;

  state.last = now;
  state.ticks += sec;
  state.play += sec;

  render();
  save();
}

function selectBuild(type) {
  selected = type;
  ["settlement","workshop","council"].forEach(function(t){
    document.getElementById("b-"+t).classList.toggle("selected", t === type);
  });
}

function place(i) {
  if (!selected || state.map[i]) return;
  state.map[i] = selected;
  state.buildings[selected]++;
  selected = null;
  render();
}

function render() {
  document.getElementById("eraValue").innerText = ERAS[state.era].name;
  document.getElementById("popValue").innerText = state.pop.toFixed(1);
  document.getElementById("prodValue").innerText = state.prod.toFixed(1);
  document.getElementById("stabValue").innerText = state.stab.toFixed(1);
  document.getElementById("playValue").innerText = Math.floor(state.play/60) + " min";
  document.getElementById("tickValue").innerText = Math.floor(state.ticks);

  var map = document.getElementById("map");
  map.innerHTML = "";
  state.map.forEach(function(c,i){
    var d = document.createElement("div");
    d.className = "tile " + (c || "empty");
    d.innerText = c ? ({settlement:"üè†",workshop:"‚öí",council:"üèõ"}[c]) : "";
    d.onclick = function(){ place(i); };
    map.appendChild(d);
  });
}

function resetGame() {
  if (!confirm("Reset the realm?")) return;
  localStorage.removeItem(KEY);
  state = defaultState();
  render();
}

setInterval(loop, 1000);
render();
</script>
</body>
</html>
